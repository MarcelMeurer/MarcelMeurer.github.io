<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logos/icon.png">

<title>Azure Trusted Launch and Custom Images - even for AVD | ITProCloud Blog</title>

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Azure Trusted Launch and Custom Images - even for AVD | ITProCloud Blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Azure Trusted Launch and Custom Images - even for AVD" />
<meta name="author" content="mm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Trusted launch for Azure virtual machines is currently in public preview (https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch). The trusted launch has some benefits, like:" />
<meta property="og:description" content="Trusted launch for Azure virtual machines is currently in public preview (https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch). The trusted launch has some benefits, like:" />
<link rel="canonical" href="https://blog.itprocloud.de/AVD-Azure-Trusted-Launch-and-Custom-Images/" />
<meta property="og:url" content="https://blog.itprocloud.de/AVD-Azure-Trusted-Launch-and-Custom-Images/" />
<meta property="og:site_name" content="ITProCloud Blog" />
<meta property="og:image" content="https://blog.itprocloud.de/assets/images/WVDAdmin/InstantBuild-01.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-13T00:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://blog.itprocloud.de/assets/images/WVDAdmin/InstantBuild-01.png" />
<meta property="twitter:title" content="Azure Trusted Launch and Custom Images - even for AVD" />
<script type="application/ld+json">
{"@type":"BlogPosting","image":"https://blog.itprocloud.de/assets/images/WVDAdmin/InstantBuild-01.png","datePublished":"2022-05-13T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.itprocloud.de/AVD-Azure-Trusted-Launch-and-Custom-Images/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://blog.itprocloud.de/assets/images/logos/itpc-logo-bottom-text.png"},"name":"mm"},"url":"https://blog.itprocloud.de/AVD-Azure-Trusted-Launch-and-Custom-Images/","author":{"@type":"Person","name":"mm"},"headline":"Azure Trusted Launch and Custom Images - even for AVD","dateModified":"2022-05-13T00:00:00+02:00","description":"Trusted launch for Azure virtual machines is currently in public preview (https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch). The trusted launch has some benefits, like:","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<!--- cookie banner --->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />

<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-page">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logos/itpc-logo-bottom-text.png" alt="ITProCloud Blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Home</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="#allTags">Show all tags</a>
                </li>
				
				<!-- Sorted tag list from https://stackoverflow.com/questions/47135736/jekyll-sort-collections-by-size -->
				<!-- Create a comma-separated string of all the sizes of the collections -->
				
				<!-- Remove last comma of string -->
				
				
				<!-- Split string into array, sort DESC, and remove duplicate elements -->
				
				<!-- Iterate through sizes, and for each size print those collections that have this size -->
				
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Windows-Virtual-Desktop">Windows Virtual Desktop (40)</a>
						</li>
					
				  
					
					
				  
					
					
				  
				
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-Virtual-Desktop">Azure Virtual Desktop (39)</a>
						</li>
					
				  
				
				  
					
					
				  
					
					
				  
					
					
				  
					
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-Monitor">Azure Monitor (10)</a>
						</li>
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
				
	
				<!-- Original tag list (unsorted) 
				
				
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-WebApp">Azure WebApp (3)</a>
						</li>
						
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-VM">Azure VM (2)</a>
						</li>
						
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#PowerShell">PowerShell (7)</a>
						</li>
						
					
				
				-->
								

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://twitter.com/MarcelMeurer"><i class="fab fa-twitter"></i></a>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.linkedin.com/in/marcel-meurer-15b46b98"><i class="fab fa-linkedin"></i></a>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/MarcelMeurer"><i class="fab fa-github"></i></a>
                </li>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="mailto:marcel.meurer@itprocloud.com?subject=Request%20from%20ITProCloud.de"><i class="far fa-envelope"></i></a>
                </li>


                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">ITProCloud Blog</h1>
    <p class="lead">
        Welcome to my blog. I'm writing this blog to share my experiences mainly in IT focused on Microsoft Azure. The blog is part of the ITProCloud GmbH.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <section>
    <div class="section-title">
        <h2><span>Azure Trusted Launch and Custom Images - even for AVD</span></h2>
    </div>

    <div class="article-post">
	
		<!-- change content to anchor styled output -->
		<p>Trusted launch for Azure virtual machines is currently in public preview (<a href="https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch">https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch</a>). The trusted launch has some benefits, like:</p>
<ul>
<li>Securely deploy virtual machines with verified boot loaders, OS kernels, and drivers.</li>
<li>Securely protect keys, certificates, and secrets in virtual machines.</li>
<li>Gain insights and confidence in the entire boot chain’s integrity.</li>
<li>Ensure workloads are trusted and verifiable.</li>
</ul>
<p>(Source: Microsoft website)</p>
<p>Technology-based, the trusted launch cannot be activated on existing VMs. Additionally, the VM size must support this feature. More importantly, a trusted launch VM can only be created from vanilla Microsoft Marketplace images. Deployment from a custom image is not working and is not supported.</p>
<p><strong>Update 20/01/2022:</strong> A native and supported process to rollout VMs and session hosts based on a custom image is expected in Feburary 2022 and will be added to <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a> and <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a> to show on <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydras’</a></p>
<p><strong>Update 13/05/2022:</strong> You can enable “Secure Boot” for marketplace images and for Custom Images in an Azure Compute Gallery (configure the VM image definition to support Secure Boot before copying a captured image to the gallery definition). #WVDAdmin and #Hydra are supporting this new feature right now
![](../assets/images/Custom-Images-with-WVDAdmin-and-Hydra-and-Secure Boot.png)</p>
<p>That’s not pretty, while in AVD, most deployments are based on images from Golden Masters. That is also the approach I’m using with my solutions (like <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a>):</p>
<ul>
<li>Rolling out a Windows 10/11 VM</li>
<li>Domain join the VM</li>
<li>Update the VM and install applications</li>
<li>Grabbing an image (with <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a>, the Master survives)</li>
<li>Rolling out session hosts based on the image</li>
</ul>
<p>I spent some time finding a workaround for deploying session hosts based on a Golden Master with secure boot enabled. I was successful, and I built this as an experimental feature into <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a> (v1.7.20).</p>
<p>How does it work:</p>
<ul>
<li>
<p>Preparing the Golden Master</p>
</li>
<li>
<ul>
<li>Rolling out a Windows 10/11 VM from the marketplace and configuring the secure boot feature</li>
<li>Domain join the VM</li>
<li>Update the VM and install applications</li>
<li>Shutdown the VM</li>
</ul>
</li>
<li>
<p>Creating session hosts from the Master</p>
</li>
<li>
<ul>
<li>Navigate in <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a> to the VM (Azure -&gt; Virtual Machines -&gt; Resource Group -&gt; VM)</li>
<li>Right-click the VM and select: “Instantly build session hosts (experimental)”</li>
<li>Configure the settings for the deployment (VM size, host pool, etc.)</li>
<li>Start the rollout</li>
</ul>
</li>
</ul>
<p>After a while, session hosts with secure boot enabled are part of the host pool. While the rollout process is more complex, it will take longer than the classic approach (the new approach is based on a snap-shot technology).</p>
<p><img src="../assets/images/WVDAdmin/InstantBuild-01.png" alt="" /></p>
<p><img src="../assets/images/WVDAdmin/InstantBuild-02.png" alt="" /></p>
<p><img src="../assets/images/WVDAdmin/InstantBuild-03.png" alt="" /></p>
<p><strong>Note:</strong> This feature is very <em>experimental</em>, and I’m looking forward to a native and supported way to deploy secure boot hosts based on a custom image. Please use it at your own risk.</p>
<p><strong>Note:</strong> If anybody finds an easier way - please let me know</p>

		<!--<p>Trusted launch for Azure virtual machines is currently in public preview (<a href="https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch">https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch</a>). The trusted launch has some benefits, like:</p>
<ul>
<li>Securely deploy virtual machines with verified boot loaders, OS kernels, and drivers.</li>
<li>Securely protect keys, certificates, and secrets in virtual machines.</li>
<li>Gain insights and confidence in the entire boot chain’s integrity.</li>
<li>Ensure workloads are trusted and verifiable.</li>
</ul>
<p>(Source: Microsoft website)</p>
<p>Technology-based, the trusted launch cannot be activated on existing VMs. Additionally, the VM size must support this feature. More importantly, a trusted launch VM can only be created from vanilla Microsoft Marketplace images. Deployment from a custom image is not working and is not supported.</p>
<p><strong>Update 20/01/2022:</strong> A native and supported process to rollout VMs and session hosts based on a custom image is expected in Feburary 2022 and will be added to <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a> and <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a> to show on <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydras’</a></p>
<p><strong>Update 13/05/2022:</strong> You can enable “Secure Boot” for marketplace images and for Custom Images in an Azure Compute Gallery (configure the VM image definition to support Secure Boot before copying a captured image to the gallery definition). #WVDAdmin and #Hydra are supporting this new feature right now
![](../assets/images/Custom-Images-with-WVDAdmin-and-Hydra-and-Secure Boot.png)</p>
<p>That’s not pretty, while in AVD, most deployments are based on images from Golden Masters. That is also the approach I’m using with my solutions (like <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a>):</p>
<ul>
<li>Rolling out a Windows 10/11 VM</li>
<li>Domain join the VM</li>
<li>Update the VM and install applications</li>
<li>Grabbing an image (with <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a>, the Master survives)</li>
<li>Rolling out session hosts based on the image</li>
</ul>
<p>I spent some time finding a workaround for deploying session hosts based on a Golden Master with secure boot enabled. I was successful, and I built this as an experimental feature into <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a> (v1.7.20).</p>
<p>How does it work:</p>
<ul>
<li>
<p>Preparing the Golden Master</p>
</li>
<li>
<ul>
<li>Rolling out a Windows 10/11 VM from the marketplace and configuring the secure boot feature</li>
<li>Domain join the VM</li>
<li>Update the VM and install applications</li>
<li>Shutdown the VM</li>
</ul>
</li>
<li>
<p>Creating session hosts from the Master</p>
</li>
<li>
<ul>
<li>Navigate in <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a> to the VM (Azure -&gt; Virtual Machines -&gt; Resource Group -&gt; VM)</li>
<li>Right-click the VM and select: “Instantly build session hosts (experimental)”</li>
<li>Configure the settings for the deployment (VM size, host pool, etc.)</li>
<li>Start the rollout</li>
</ul>
</li>
</ul>
<p>After a while, session hosts with secure boot enabled are part of the host pool. While the rollout process is more complex, it will take longer than the classic approach (the new approach is based on a snap-shot technology).</p>
<p><img src="../assets/images/WVDAdmin/InstantBuild-01.png" alt="" /></p>
<p><img src="../assets/images/WVDAdmin/InstantBuild-02.png" alt="" /></p>
<p><img src="../assets/images/WVDAdmin/InstantBuild-03.png" alt="" /></p>
<p><strong>Note:</strong> This feature is very <em>experimental</em>, and I’m looking forward to a native and supported way to deploy secure boot hosts based on a custom image. Please use it at your own risk.</p>
<p><strong>Note:</strong> If anybody finds an easier way - please let me know</p>
-->
	
    
</section>
</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div id="allTags" class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore by tags <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Azure-WebApp">Azure WebApp (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-VM">Azure VM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PowerShell">PowerShell (7)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Monitor">Azure Monitor (10)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Log-Analytics">Log Analytics (7)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-AD">Azure AD (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OneDrive">OneDrive (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-IoT">Azure IoT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Functions">Azure Functions (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Marketplace">Azure Marketplace (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Windows-Virtual-Desktop">Windows Virtual Desktop (40)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Events">Events (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Virtual-Desktop">Azure Virtual Desktop (39)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-5 col-sm-5 text-center text-lg-left">
                Copyright © 2022 ITProCloud Blog 
            </div>
            <div class="col-md-4 col-sm-4 text-center text-lg-left">
                <a href="/Impressum">Impressum</a>/<a href="/ImpressumEn">Imprint</a> - 
                <a href="/privacyDe">Datenschutz</a> - 
				<a href="/privacyEn">Privacy</a>
            </div>
            <div class="col-md-3 col-sm-3 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 



<!-- Start Cookie Plugin -->
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eaf7f7",
      "text": "#5c7291"
    },
    "button": {
      "background": "#56cbdb",
      "text": "#ffffff"
    }
  },
  "position": "bottom-right",
  "content": {
    "message": 'This website uses cookies to ensure you get the best experience on our website.<br/><a href="/privacyEn">Privacy policy</a><br/><br/>Diese Website verwendet Cookies, um dir mehr Benutzerfreundlichkeit zu bieten. Mit der Nutzung dieser Website stimmst du der Verwendung von Cookies zu.<br/><a href="/privacyDe">Datenschutzerklärung</a><br/><br/> ',
    "href": "/privacyEn"
  }
});
</script>
<!-- End Cookie Plugin -->

</body>
</html>
