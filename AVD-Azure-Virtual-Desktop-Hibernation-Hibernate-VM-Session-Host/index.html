<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logos/icon.png">

<title>Microsoft Azure and hibernated Virtual Machines and Azure Virtual Desktop Hibernation  | ITProCloud Blog</title>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Microsoft Azure and hibernated Virtual Machines and Azure Virtual Desktop Hibernation | ITProCloud Blog</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Microsoft Azure and hibernated Virtual Machines and Azure Virtual Desktop Hibernation" />
<meta name="author" content="mm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Microsoft introduced a new feature for Virtual Machines: Hibernation (link to MS post). That is awesome and allows totally new scenarios, not even for Azure Virtual Desktop. But used with Azure Virtual Desktop, hibernation gives new possibilities to provide desktop. I certainly don&#39;t need to mention that a hibernated VM has no compute costs." />
<meta property="og:description" content="Microsoft introduced a new feature for Virtual Machines: Hibernation (link to MS post). That is awesome and allows totally new scenarios, not even for Azure Virtual Desktop. But used with Azure Virtual Desktop, hibernation gives new possibilities to provide desktop. I certainly don&#39;t need to mention that a hibernated VM has no compute costs." />
<link rel="canonical" href="https://blog.itprocloud.de/AVD-Azure-Virtual-Desktop-Hibernation-Hibernate-VM-Session-Host/" />
<meta property="og:url" content="https://blog.itprocloud.de/AVD-Azure-Virtual-Desktop-Hibernation-Hibernate-VM-Session-Host/" />
<meta property="og:site_name" content="ITProCloud Blog" />
<meta property="og:image" content="https://blog.itprocloud.de/assets/images/Avd-Hibernation-01.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-11-15T00:00:00-08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://blog.itprocloud.de/assets/images/Avd-Hibernation-01.png" />
<meta property="twitter:title" content="Microsoft Azure and hibernated Virtual Machines and Azure Virtual Desktop Hibernation" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"mm"},"dateModified":"2023-11-15T00:00:00-08:00","datePublished":"2023-11-15T00:00:00-08:00","description":"Microsoft introduced a new feature for Virtual Machines: Hibernation (link to MS post). That is awesome and allows totally new scenarios, not even for Azure Virtual Desktop. But used with Azure Virtual Desktop, hibernation gives new possibilities to provide desktop. I certainly don&#39;t need to mention that a hibernated VM has no compute costs.","headline":"Microsoft Azure and hibernated Virtual Machines and Azure Virtual Desktop Hibernation","image":"https://blog.itprocloud.de/assets/images/Avd-Hibernation-01.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.itprocloud.de/AVD-Azure-Virtual-Desktop-Hibernation-Hibernate-VM-Session-Host/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://blog.itprocloud.de/assets/images/logos/itpc-logo-bottom-text.png"},"name":"mm"},"url":"https://blog.itprocloud.de/AVD-Azure-Virtual-Desktop-Hibernation-Hibernate-VM-Session-Host/"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<!--- cookie banner --->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />

<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-page">
	<!-- defer loading of font and font awesome -->
	<!-- <noscript id="deferred-styles"> -->
		<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous"> -->
	<!-- </noscript> -->


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logos/itpc-logo-bottom-text.png" alt="ITProCloud Blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Home</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/tools"><b>Tools</b></a>
                </li>
				
                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="#allTags">Show all tags</a>
                </li>
				
				<!-- Sorted tag list from https://stackoverflow.com/questions/47135736/jekyll-sort-collections-by-size -->
				<!-- Create a comma-separated string of all the sizes of the collections -->
				
				<!-- Remove last comma of string -->
				
				
				<!-- Split string into array, sort DESC, and remove duplicate elements -->
				
				<!-- Iterate through sizes, and for each size print those collections that have this size -->
				
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Windows-Virtual-Desktop">Windows Virtual Desktop (69)</a>
						</li>
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
				
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-Virtual-Desktop">Azure Virtual Desktop (68)</a>
						</li>
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
				
				  
					
					
				  
					
					
				  
					
					
				  
					
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-Monitor">Azure Monitor (12)</a>
						</li>
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
					
					
				  
				
	
				<!-- Original tag list (unsorted) 
				
				
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-WebApp">Azure WebApp (3)</a>
						</li>
						
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-VM">Azure VM (2)</a>
						</li>
						
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#PowerShell">PowerShell (9)</a>
						</li>
						
					
				
				-->
								

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://twitter.com/MarcelMeurer"><i class="fab fa-twitter"></i></a>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.linkedin.com/in/marcel-meurer-15b46b98"><i class="fab fa-linkedin"></i></a>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/MarcelMeurer"><i class="fab fa-github"></i></a>
                </li>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="mailto:marcel.meurer@itprocloud.com?subject=Request%20from%20ITProCloud.de"><i class="far fa-envelope"></i></a>
                </li>


                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">ITProCloud Blog</h1>
    <p class="lead">
        Welcome to my blog. I'm writing this blog to share my experiences mainly in IT focused on Microsoft Azure. The blog is part of the ITProCloud GmbH.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <section>
    <div class="section-title">
        <h2><span>Microsoft Azure and hibernated Virtual Machines and Azure Virtual Desktop Hibernation </span></h2>
    </div>

    <div class="article-post">
	
		<!-- change content to anchor styled output -->
		<p>Microsoft introduced a new feature for Virtual Machines: Hibernation (link to MS post). That is awesome and allows totally new scenarios, not even for Azure Virtual Desktop. But used with Azure Virtual Desktop, hibernation gives new possibilities to provide desktop. I certainly don&#39;t need to mention that a hibernated VM has no compute costs.</p>

<p>Thanks a lot to Microsoft and the AVD product group for the invitation to the private preview and the encouragement to adapt my products accordingly.</p>
      <h3 id="how-does-hibernation-work-in-azure">
        
        
          How does hibernation work in Azure? <a href="#how-does-hibernation-work-in-azure"><img src="/assets/icons/link.png" alt="Link" width="15" height="15"></a>
        
        
      </h3>
    

<p>The possibility of hibernation can be configured during the rollout of new virtual machines (Gallery Images) or for existing virtual machines. For both cases: The VM type must support hibernation, and the OS disk must be large enough to store the OS, the pagefile, and the hibernation file (size of the memory). For existing VMs, the pagefile must be moved to C: before. For VMs or AVD session hosts, you can use the free <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">#WVDAdmin</a> tool to convert existing VMs or rollout new VMs (tick the checkbox). In both cases, the page file is moved to C: automatically.
<img src="../assets/images/Avd-Hibernation-01.png" alt="">
<img src="../assets/images/Avd-Hibernation-02.png" alt=""></p>

<p>A VM or session host can be hibernated with <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">#WVDAdmin</a> or <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">#Hydra</a>. 
<img src="../assets/images/Avd-Hibernation-03.png" alt="">
<img src="../assets/images/Avd-Hibernation-04.png" alt=""></p>

<p>The Virtual Machines note in <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">#WVDAdmin</a> shows the hibernation mode of a VM.
<img src="../assets/images/Avd-Hibernation-05.png" alt=""></p>

<p>Important to know: You can not modify the disk of a hibernated VM. That includes not changing the disk type to HDD after the deallocation (that can be configured using Hydras&#39; autoscaling). Hint: I guess I found a way to do both. I would update this post if I validated this.</p>
      <h3 id="hibernation-for-avd-personal-hosts">
        
        
          Hibernation for AVD personal hosts <a href="#hibernation-for-avd-personal-hosts"><img src="/assets/icons/link.png" alt="Link" width="15" height="15"></a>
        
        
      </h3>
    

<p>VDI users have the highest benefit from using hibernation. After the work is done, they can hibernate the host and continue working later while all the applications stay open. Currently, the Microsoft AVD autoscaling cannot support the user with hibernation. If you are using <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a>, you can configure hibernation for VDI: Configure a timeout for a disconnected session and tic the box &quot;Prefer hibernation&quot; (the VM must support hibernation; convert an existing VM with <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">#WVDAdmin</a>):
<img src="../assets/images/Avd-Hibernation-06.png" alt=""></p>

<p>If the user disconnect, the session host will be hibernated by <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a>. If the user tries to reconnect (e.g., with Power-On-Connect), the VM starts, and the user can continue.</p>

<p>Additionally, tick the two boxes &quot;Prefer hibernation&quot; and &quot;Handle user-initiated hibernation (Experimental)&quot; in Autoscale and Autoshutdown to allow a user with the proper rights to hibernate inside of Windows. In this case, <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a> ensures that the VM goes into the correct hibernation mode.
<img src="../assets/images/Avd-Hibernation-07.png" alt=""></p>
      <h3 id="hibernation-for-avd-pooled-hosts">
        
        
          Hibernation for AVD pooled hosts <a href="#hibernation-for-avd-pooled-hosts"><img src="/assets/icons/link.png" alt="Link" width="15" height="15"></a>
        
        
      </h3>
    

<p>Awaking a VM is in the physical world faster than starting Windows. So it could make sense to prefer hibernation to bring hosts down if they are no longer needed and awake the hosts on demand. <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a> also allows autoscaling with hibernation if you tick  &quot;Prefer hibernation&quot; in Autoscale and Autoshutdown.
But how big is the speed advantage? I did some measurements to figure this out. For this case, I used a VM (DS3 v2), 256 GByte OS-disk and did several starts with several options. </p>

<p>In every scenario, I measured three values:
- X: Seconds to bring the VM from deallocated to running
- Y: Seconds from deallocated to be available in AVD
- Z: Seconds to deallocate/hibernate the VM</p>

<p><br/></p>

<p><strong>Scenario 1:</strong> Hibernated VM (withou session), OS-disk is HDD</p>

<table><thead>
<tr>
<th></th>
<th>x: deallocated to running</th>
<th>y: deallocated to be available</th>
<th>z: hibernate</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>18</td>
<td>86</td>
<td>64</td>
</tr>
<tr>
<td>2</td>
<td>18</td>
<td>80</td>
<td>63</td>
</tr>
<tr>
<td>3</td>
<td>18</td>
<td>87</td>
<td>64</td>
</tr>
<tr>
<td>4</td>
<td>17</td>
<td>83</td>
<td>64</td>
</tr>
<tr>
<td>5</td>
<td>17</td>
<td>81</td>
<td>51</td>
</tr>
<tr>
<td>6</td>
<td>8</td>
<td>94</td>
<td>69</td>
</tr>
<tr>
<td><strong>Avg:</strong></td>
<td>17.7</td>
<td>85.2</td>
<td>62.5</td>
</tr>
</tbody></table>

<p><br/></p>

<p><strong>Scenario 2:</strong> Hibernated VM (withou session), OS-disk is Premium</p>

<table><thead>
<tr>
<th></th>
<th>x: deallocated to running</th>
<th>y: deallocated to be available</th>
<th>z: hibernate</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>26</td>
<td>49</td>
<td>45</td>
</tr>
<tr>
<td>2</td>
<td>17</td>
<td>56</td>
<td>59</td>
</tr>
<tr>
<td>3</td>
<td>21</td>
<td>56</td>
<td>61</td>
</tr>
<tr>
<td>4</td>
<td>26</td>
<td>55</td>
<td>44</td>
</tr>
<tr>
<td>5</td>
<td>39</td>
<td>72</td>
<td>48</td>
</tr>
<tr>
<td>6</td>
<td>17</td>
<td>56</td>
<td>44</td>
</tr>
<tr>
<td><strong>Avg:</strong></td>
<td>24.3</td>
<td>57.3</td>
<td>50.2</td>
</tr>
</tbody></table>

<p><br/></p>

<p><strong>Scenario 3:</strong> Deallocated VM, OS-disk is HDD</p>

<table><thead>
<tr>
<th></th>
<th>x: deallocated to running</th>
<th>y: deallocated to be available</th>
<th>z: deallocate</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>17</td>
<td>117</td>
<td>40</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>119</td>
<td>44</td>
</tr>
<tr>
<td>3</td>
<td>16</td>
<td>113</td>
<td>44</td>
</tr>
<tr>
<td>4</td>
<td>15</td>
<td>102</td>
<td>39</td>
</tr>
<tr>
<td>5</td>
<td>15</td>
<td>110</td>
<td>50</td>
</tr>
<tr>
<td>6</td>
<td>21</td>
<td>111</td>
<td>67</td>
</tr>
<tr>
<td><strong>Avg:</strong></td>
<td>17.3</td>
<td>112</td>
<td>47.3</td>
</tr>
</tbody></table>

<p><br/></p>

<p><strong>Scenario 4:</strong> Deallocated VM, OS-disk is Premium</p>

<table><thead>
<tr>
<th></th>
<th>x: deallocated to running</th>
<th>y: deallocated to be available</th>
<th>z: deallocate</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>20</td>
<td>81</td>
<td>44</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>77</td>
<td>43</td>
</tr>
<tr>
<td>3</td>
<td>13</td>
<td>85</td>
<td>36</td>
</tr>
<tr>
<td>4</td>
<td>49</td>
<td>113</td>
<td>37</td>
</tr>
<tr>
<td>5</td>
<td>23</td>
<td>82</td>
<td>45</td>
</tr>
<tr>
<td>6</td>
<td>18</td>
<td>42</td>
<td>38</td>
</tr>
<tr>
<td><strong>Avg:</strong></td>
<td>23.8</td>
<td>80</td>
<td>40.5</td>
</tr>
</tbody></table>

<p><br/></p>

<p>The time for a hibernated host to become available in AVD is <strong>23% faster</strong> than starting a deallocated host.</p>

<p>Hibernation is <strong>23%</strong> faster than the deallocation and allocation of a VM or session host. While you need bigger OS disks for hibernation and while you cannot use Hydras&#39; advantages of switching disk types (to HDD after deallocation and to premium before starting a host). So, it&#39;s up to you to use hibernation for pooled hosts. I would go the start/stop way for pooled hosts to continue using smaller disks and the HDD-type switching feature. But for personal / VDI hosts, it can make absolute sense: It&#39;s an excellent user experience for the end-users.</p>
      <h3 id="fazit">
        
        
          Fazit: <a href="#fazit"><img src="/assets/icons/link.png" alt="Link" width="15" height="15"></a>
        
        
      </h3>
    

<p>As I mentioned before, I&#39;m thrilled to be involved in the preview to prepare my tools and solutions around AVD. Hibernation is fantastic and, especially for personal host pools, a great experience. Feel free to check out my tools (I only list the new features around hibernation):</p>

<p><strong><a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a> - my free community solution to work with AVD</strong>
- Hibernate and awake session hosts
- Hibernate and awake VMs
- Rollout session hosts based on a custom image with hibernation enabled
- Reconfigure suitable VMs to use hibernation
- List all VMs and show the hibernation state</p>

<p><strong><a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a> - free for up to 6 hosts per pool</strong>
- Hibernate and awake session hosts / VMs
- Next week: Rollout session hosts based on a custom image with hibernation enabled
- Autoscaling with &quot;Prefer Hibernation&quot; for pooled hosts
- Autoscaling with &quot;Prefer Hibernation&quot; for VDIs (preserves the user session)
- Hibernates a VDI after a session is disconnected for a while
- Hibernates a VDI after a user-initiated hibernation inside of Windows</p>

<p>Please let me know what you think about using hibernation in AVD.</p>

		<!--<p>Microsoft introduced a new feature for Virtual Machines: Hibernation (link to MS post). That is awesome and allows totally new scenarios, not even for Azure Virtual Desktop. But used with Azure Virtual Desktop, hibernation gives new possibilities to provide desktop. I certainly don&#39;t need to mention that a hibernated VM has no compute costs.</p>

<p>Thanks a lot to Microsoft and the AVD product group for the invitation to the private preview and the encouragement to adapt my products accordingly.</p>

<h3 id="how-does-hibernation-work-in-azure">How does hibernation work in Azure?</h3>

<p>The possibility of hibernation can be configured during the rollout of new virtual machines (Gallery Images) or for existing virtual machines. For both cases: The VM type must support hibernation, and the OS disk must be large enough to store the OS, the pagefile, and the hibernation file (size of the memory). For existing VMs, the pagefile must be moved to C: before. For VMs or AVD session hosts, you can use the free <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">#WVDAdmin</a> tool to convert existing VMs or rollout new VMs (tick the checkbox). In both cases, the page file is moved to C: automatically.
<img src="../assets/images/Avd-Hibernation-01.png" alt="">
<img src="../assets/images/Avd-Hibernation-02.png" alt=""></p>

<p>A VM or session host can be hibernated with <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">#WVDAdmin</a> or <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">#Hydra</a>. 
<img src="../assets/images/Avd-Hibernation-03.png" alt="">
<img src="../assets/images/Avd-Hibernation-04.png" alt=""></p>

<p>The Virtual Machines note in <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">#WVDAdmin</a> shows the hibernation mode of a VM.
<img src="../assets/images/Avd-Hibernation-05.png" alt=""></p>

<p>Important to know: You can not modify the disk of a hibernated VM. That includes not changing the disk type to HDD after the deallocation (that can be configured using Hydras&#39; autoscaling). Hint: I guess I found a way to do both. I would update this post if I validated this.</p>

<h3 id="hibernation-for-avd-personal-hosts">Hibernation for AVD personal hosts</h3>

<p>VDI users have the highest benefit from using hibernation. After the work is done, they can hibernate the host and continue working later while all the applications stay open. Currently, the Microsoft AVD autoscaling cannot support the user with hibernation. If you are using <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a>, you can configure hibernation for VDI: Configure a timeout for a disconnected session and tic the box &quot;Prefer hibernation&quot; (the VM must support hibernation; convert an existing VM with <a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">#WVDAdmin</a>):
<img src="../assets/images/Avd-Hibernation-06.png" alt=""></p>

<p>If the user disconnect, the session host will be hibernated by <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a>. If the user tries to reconnect (e.g., with Power-On-Connect), the VM starts, and the user can continue.</p>

<p>Additionally, tick the two boxes &quot;Prefer hibernation&quot; and &quot;Handle user-initiated hibernation (Experimental)&quot; in Autoscale and Autoshutdown to allow a user with the proper rights to hibernate inside of Windows. In this case, <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a> ensures that the VM goes into the correct hibernation mode.
<img src="../assets/images/Avd-Hibernation-07.png" alt=""></p>

<h3 id="hibernation-for-avd-pooled-hosts">Hibernation for AVD pooled hosts</h3>

<p>Awaking a VM is in the physical world faster than starting Windows. So it could make sense to prefer hibernation to bring hosts down if they are no longer needed and awake the hosts on demand. <a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a> also allows autoscaling with hibernation if you tick  &quot;Prefer hibernation&quot; in Autoscale and Autoshutdown.
But how big is the speed advantage? I did some measurements to figure this out. For this case, I used a VM (DS3 v2), 256 GByte OS-disk and did several starts with several options. </p>

<p>In every scenario, I measured three values:
- X: Seconds to bring the VM from deallocated to running
- Y: Seconds from deallocated to be available in AVD
- Z: Seconds to deallocate/hibernate the VM</p>

<p><br/></p>

<p><strong>Scenario 1:</strong> Hibernated VM (withou session), OS-disk is HDD</p>

<table><thead>
<tr>
<th></th>
<th>x: deallocated to running</th>
<th>y: deallocated to be available</th>
<th>z: hibernate</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>18</td>
<td>86</td>
<td>64</td>
</tr>
<tr>
<td>2</td>
<td>18</td>
<td>80</td>
<td>63</td>
</tr>
<tr>
<td>3</td>
<td>18</td>
<td>87</td>
<td>64</td>
</tr>
<tr>
<td>4</td>
<td>17</td>
<td>83</td>
<td>64</td>
</tr>
<tr>
<td>5</td>
<td>17</td>
<td>81</td>
<td>51</td>
</tr>
<tr>
<td>6</td>
<td>8</td>
<td>94</td>
<td>69</td>
</tr>
<tr>
<td><strong>Avg:</strong></td>
<td>17.7</td>
<td>85.2</td>
<td>62.5</td>
</tr>
</tbody></table>

<p><br/></p>

<p><strong>Scenario 2:</strong> Hibernated VM (withou session), OS-disk is Premium</p>

<table><thead>
<tr>
<th></th>
<th>x: deallocated to running</th>
<th>y: deallocated to be available</th>
<th>z: hibernate</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>26</td>
<td>49</td>
<td>45</td>
</tr>
<tr>
<td>2</td>
<td>17</td>
<td>56</td>
<td>59</td>
</tr>
<tr>
<td>3</td>
<td>21</td>
<td>56</td>
<td>61</td>
</tr>
<tr>
<td>4</td>
<td>26</td>
<td>55</td>
<td>44</td>
</tr>
<tr>
<td>5</td>
<td>39</td>
<td>72</td>
<td>48</td>
</tr>
<tr>
<td>6</td>
<td>17</td>
<td>56</td>
<td>44</td>
</tr>
<tr>
<td><strong>Avg:</strong></td>
<td>24.3</td>
<td>57.3</td>
<td>50.2</td>
</tr>
</tbody></table>

<p><br/></p>

<p><strong>Scenario 3:</strong> Deallocated VM, OS-disk is HDD</p>

<table><thead>
<tr>
<th></th>
<th>x: deallocated to running</th>
<th>y: deallocated to be available</th>
<th>z: deallocate</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>17</td>
<td>117</td>
<td>40</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>119</td>
<td>44</td>
</tr>
<tr>
<td>3</td>
<td>16</td>
<td>113</td>
<td>44</td>
</tr>
<tr>
<td>4</td>
<td>15</td>
<td>102</td>
<td>39</td>
</tr>
<tr>
<td>5</td>
<td>15</td>
<td>110</td>
<td>50</td>
</tr>
<tr>
<td>6</td>
<td>21</td>
<td>111</td>
<td>67</td>
</tr>
<tr>
<td><strong>Avg:</strong></td>
<td>17.3</td>
<td>112</td>
<td>47.3</td>
</tr>
</tbody></table>

<p><br/></p>

<p><strong>Scenario 4:</strong> Deallocated VM, OS-disk is Premium</p>

<table><thead>
<tr>
<th></th>
<th>x: deallocated to running</th>
<th>y: deallocated to be available</th>
<th>z: deallocate</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>20</td>
<td>81</td>
<td>44</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>77</td>
<td>43</td>
</tr>
<tr>
<td>3</td>
<td>13</td>
<td>85</td>
<td>36</td>
</tr>
<tr>
<td>4</td>
<td>49</td>
<td>113</td>
<td>37</td>
</tr>
<tr>
<td>5</td>
<td>23</td>
<td>82</td>
<td>45</td>
</tr>
<tr>
<td>6</td>
<td>18</td>
<td>42</td>
<td>38</td>
</tr>
<tr>
<td><strong>Avg:</strong></td>
<td>23.8</td>
<td>80</td>
<td>40.5</td>
</tr>
</tbody></table>

<p><br/></p>

<p>The time for a hibernated host to become available in AVD is <strong>23% faster</strong> than starting a deallocated host.</p>

<p>Hibernation is <strong>23%</strong> faster than the deallocation and allocation of a VM or session host. While you need bigger OS disks for hibernation and while you cannot use Hydras&#39; advantages of switching disk types (to HDD after deallocation and to premium before starting a host). So, it&#39;s up to you to use hibernation for pooled hosts. I would go the start/stop way for pooled hosts to continue using smaller disks and the HDD-type switching feature. But for personal / VDI hosts, it can make absolute sense: It&#39;s an excellent user experience for the end-users.</p>

<h3 id="fazit">Fazit:</h3>

<p>As I mentioned before, I&#39;m thrilled to be involved in the preview to prepare my tools and solutions around AVD. Hibernation is fantastic and, especially for personal host pools, a great experience. Feel free to check out my tools (I only list the new features around hibernation):</p>

<p><strong><a href="https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/">WVDAdmin</a> - my free community solution to work with AVD</strong>
- Hibernate and awake session hosts
- Hibernate and awake VMs
- Rollout session hosts based on a custom image with hibernation enabled
- Reconfigure suitable VMs to use hibernation
- List all VMs and show the hibernation state</p>

<p><strong><a href="https://blog.itprocloud.de/Hydra-for-Azure-Virtual-Desktop-AVD-is-available-in-the-Azure-Marketplace/">Hydra</a> - free for up to 6 hosts per pool</strong>
- Hibernate and awake session hosts / VMs
- Next week: Rollout session hosts based on a custom image with hibernation enabled
- Autoscaling with &quot;Prefer Hibernation&quot; for pooled hosts
- Autoscaling with &quot;Prefer Hibernation&quot; for VDIs (preserves the user session)
- Hibernates a VDI after a session is disconnected for a while
- Hibernates a VDI after a user-initiated hibernation inside of Windows</p>

<p>Please let me know what you think about using hibernation in AVD.</p>
-->
	
    
</section>
</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div id="allTags" class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore by tags <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Azure-WebApp">Azure WebApp (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-VM">Azure VM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PowerShell">PowerShell (9)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Monitor">Azure Monitor (12)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Log-Analytics">Log Analytics (9)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-AD">Azure AD (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OneDrive">OneDrive (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-IoT">Azure IoT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Functions">Azure Functions (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Marketplace">Azure Marketplace (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (8)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Windows-Virtual-Desktop">Windows Virtual Desktop (69)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Events">Events (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Virtual-Desktop">Azure Virtual Desktop (68)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Webapp">Azure Webapp (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ADConnect">ADConnect (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Stack-HCI">Azure Stack HCI (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Entra">Entra (2)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-5 col-sm-5 text-center text-lg-left">
                Copyright © 2025 ITProCloud Blog 
            </div>
            <div class="col-md-4 col-sm-4 text-center text-lg-left">
                <a href="/Impressum">Impressum</a>/<a href="/ImpressumEn">Imprint</a> - 
                <a href="/privacyDe">Datenschutz</a> - 
				<a href="/privacyEn">Privacy</a> - 
				<a href="#" id="open_preferences_center">Update cookies preferences</a>
            </div>
            <div class="col-md-3 col-sm-3 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 



<!-- Cookie Consent by TermsFeed https://www.TermsFeed.com created on https://www.cookieconsent.com/ -->
<script type="text/javascript" src="https://www.termsfeed.com/public/cookie-consent/4.1.0/cookie-consent.js" charset="UTF-8"></script>
<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({"notice_banner_type":"simple","consent_type":"express","palette":"light","language":"en","page_load_consent_levels":["strictly-necessary"],"notice_banner_reject_button_hide":false,"preferences_center_close_button_hide":false,"page_refresh_confirmation_buttons":false,"website_name":"blog.ITProCloud.de","website_privacy_policy_url":"https://blog.itprocloud.de/privacyEn/"});
});
</script>

<!-- Google Analytics -->
<!-- Google tag (gtag.js) -->
<script type="text/plain" data-cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=G-LPJZ1BMG3V">
</script>
<script type="text/plain" data-cookie-consent="tracking">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LPJZ1BMG3V');
</script>
<!-- end of Google Analytics-->

<noscript>Free cookie consent management tool by <a href="https://www.termsfeed.com/">TermsFeed</a></noscript>
<!-- End Cookie Consent by TermsFeed https://www.TermsFeed.com -->

</body>
</html>
