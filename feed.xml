<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ITProCloud Blog</title>
    <description>This is my personal website, which I maintain to support the cloud community. ITProCloud.de is the label I use for tests and demonstrations. ITProCloud.de is not a company in the business sense.</description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Tue, 05 May 2020 20:56:09 +0200</pubDate>
    <lastBuildDate>Tue, 05 May 2020 20:56:09 +0200</lastBuildDate>
    <generator>Jekyll v4.0.0</generator>
    
      <item>
        <title>Windows Virtual Desktop - Monitoring the Spring Backend - WVD</title>
        <description>&lt;p&gt;The long await update from WVD is public. It comes with a full ARM integration and is natively useable in the Azure Portal. Some things changed from the Fall to Spring update, and that’s include monitoring.&lt;/p&gt;

&lt;p&gt;In this post, I’m focused on monitoring the WVD backend and not monitoring the sessions, applications, session host performance, latency, etc. To exactly monitoring these metrics, check out the solution &lt;a href=&quot;https://www.sepago.de/en/azure-monitor-en/&quot;&gt;“Azure Monitor for WVD”&lt;/a&gt; which works for Fall and the Spring update - and the new version comes with great Azure workbooks to additionally visualize data by host pool.&lt;/p&gt;

&lt;p&gt;The Fall update writes logs to Azure Monitor / Log Analytics as custom logs. There is a &lt;a href=&quot;https://techcommunity.microsoft.com/t5/azure-sentinel/monitoring-windows-virtual-desktop-environments-fall-2019/ba-p/1356632&quot;&gt;really good blog post&lt;/a&gt; about this.&lt;/p&gt;

&lt;p&gt;The Spring update writes logs to Log Analytics as well, but they have a different name and schema. To enable logging the backend, you have to enable the diagnostic settings on all involved resources:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Workspace&lt;/li&gt;
  &lt;li&gt;Host Pool&lt;/li&gt;
  &lt;li&gt;App Group&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Make sure that you select all logs and select your Log Analytics workspace (if you use sepago’s “Azure Monitor for WVD” use the same Log Analytics workspace for the backend logging)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\Azure Monitor for WVD\Blog-01-05.png&quot; alt=&quot;Registry with values&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you have done this for all resources, the WVD send logs to the selected workspace. Keep in mind that writing the first entries can take up to 20 minutes to build the data schema initially.&lt;/p&gt;

&lt;p&gt;After a while, you should have log data in your Log Analytics workspace:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\Azure Monitor for WVD\Blog-01-06.png&quot; alt=&quot;Registry with values&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You can see the following logs (tables):&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;WVDCheckpoints
    &lt;ul&gt;
      &lt;li&gt;Intermediate steps while establishing and running a connection&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;WVDConnections
    &lt;ul&gt;
      &lt;li&gt;Start/End of connections&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;WVDErrors
    &lt;ul&gt;
      &lt;li&gt;Errors while establishing a connection, failures during the administration, failures getting feed informations&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;WVDHostRegistrations
    &lt;ul&gt;
      &lt;li&gt;About session host registration to host pools&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;WVDManagement
    &lt;ul&gt;
      &lt;li&gt;Administration log&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The logs are internally connectable with their correlation id you have in each log.&lt;/p&gt;

&lt;h2 id=&quot;lets-start-digging-some-data&quot;&gt;Let’s start digging some data&lt;/h2&gt;

&lt;p&gt;Open Log Analytics an go to “Logs” and run your queries based on the KUSTO query language.&lt;/p&gt;

&lt;h3 id=&quot;count-of-brokered-sessions-by-state&quot;&gt;Count of brokered sessions by state&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;WVDConnections 
| where State =~ &quot;Started&quot; and Type =~&quot;WVDConnections&quot; 
| extend CState=iff(SessionHostOSVersion==&quot;&amp;lt;&amp;gt;&quot;,&quot;Failure&quot;,&quot;Success&quot;) | summarize Count=count() by State=CState
| render piechart 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\Azure Monitor for WVD\Blog-01-02.png&quot; alt=&quot;Registry with values&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;failed-connections&quot;&gt;Failed connections&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;WVDConnections 
| where State =~ &quot;Started&quot; and Type =~&quot;WVDConnections&quot; 
| extend Multi=split(_ResourceId, &quot;/&quot;) | extend CState=iff(SessionHostOSVersion==&quot;&amp;lt;&amp;gt;&quot;,&quot;Failure&quot;,&quot;Success&quot;)
| where CState=~&quot;Failure&quot; 
| project TimeStamp=TimeGenerated, UserName, ResourceGroup=Multi[4], HostPool=Multi[8],ResourceAlias, SessionHost=SessionHostName, ClientOS=ClientOS, ClientWvdVersion=ClientVersion, CorrelationId
| order by TimeStamp desc
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;failed-connection-with-details&quot;&gt;Failed connection with details&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;WVDConnections | where State =~ &quot;Started&quot; and Type =~&quot;WVDConnections&quot; 
| extend Multi=split(_ResourceId, &quot;/&quot;) | extend CState=iff(SessionHostOSVersion==&quot;&amp;lt;&amp;gt;&quot;,&quot;Failure&quot;,&quot;Success&quot;)
| where CState =~&quot;Failure&quot;
| order by TimeGenerated desc
| where State =~ &quot;Started&quot; | extend Multi=split(_ResourceId, &quot;/&quot;) 
| project ResourceAlias, ResourceGroup=Multi[4], HostPool=Multi[8], SessionHostName ,UserName ,CState=iff(SessionHostOSVersion==&quot;&amp;lt;&amp;gt;&quot;,&quot;Failure&quot;,&quot;Success&quot;), CorrelationId, TimeGenerated
| join kind= leftouter (
    WVDErrors 
) on CorrelationId
| extend DurationFromLogon=datetime_diff(&quot;Second&quot;,TimeGenerated1,TimeGenerated)
| project  TimeStamp=TimeGenerated, DurationFromLogon, UserName, ResourceAlias ,SessionHost=SessionHostName ,Source ,CodeSymbolic , ErrorMessage=Message, ErrorCode=Code, ErrorSource=Source ,ServiceError, CorrelationId
| order by TimeStamp desc
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;session-logon-duration-by-host-pool&quot;&gt;Session logon duration by host pool&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;WVDConnections 
| where Type =~&quot;WVDConnections&quot; and State =~ &quot;Started&quot; | extend Multi=split(_ResourceId, &quot;/&quot;) | project ResourceAlias, HostPool=toupper(HP=Multi[8]), SessionHostName , UserName ,CState=iff(SessionHostOSVersion==&quot;&amp;lt;&amp;gt;&quot;,&quot;Failure&quot;,&quot;Success&quot;), CorrelationId, TimeGenerated, ResourceGroup=Multi[4], DesktopGroup_s=toupper(strcat(RG=Multi[4],&quot;.&quot;, HP=Multi[8])) 
| join kind= leftouter (
    WVDCheckpoints 
) on CorrelationId
| extend DurationFromLogon=datetime_diff(&quot;Second&quot;,TimeGenerated1,TimeGenerated)
| where Name=~&quot;RdpStackLogon&quot; 
| project UserName, ResourceGroup, DesktopGroup_s,SessionHost=SessionHostName, TimeStamp=TimeGenerated1, DurationFromLogon
| summarize DurationInSeconds=avg(DurationFromLogon) by HostPool=DesktopGroup_s 
| render columnchart kind=unstacked 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\Azure Monitor for WVD\Blog-01-01.png&quot; alt=&quot;Registry with values&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;session-logon-duration-by-user-desc&quot;&gt;Session logon duration by user (desc)&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&quot;language-kusto&quot;&gt;WVDConnections 
| where Type =~&quot;WVDConnections&quot; and State =~ &quot;Started&quot; | extend Multi=split(_ResourceId, &quot;/&quot;) | project ResourceAlias, HostPool=toupper(HP=Multi[8]), SessionHostName , UserName ,CState=iff(SessionHostOSVersion==&quot;&amp;lt;&amp;gt;&quot;,&quot;Failure&quot;,&quot;Success&quot;), CorrelationId, TimeGenerated, ResourceGroup=Multi[4], DesktopGroup_s=toupper(strcat(RG=Multi[4],&quot;.&quot;, HP=Multi[8])) 
| join kind= leftouter (
    WVDCheckpoints 
) on CorrelationId
| extend DurationFromLogon=datetime_diff(&quot;Second&quot;,TimeGenerated1,TimeGenerated)
| where Name=~&quot;RdpStackLogon&quot; 
| project UserName, ResourceGroup, DesktopGroup_s,SessionHost=SessionHostName, TimeStamp=TimeGenerated1, DurationFromLogon
| summarize DurationInSeconds=avg(DurationFromLogon) by HostPool=UserName
| order by DurationInSeconds desc 
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;administrative-activities-over-time&quot;&gt;Administrative activities over time&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;WVDManagement 
| summarize Count=count() by bin(TimeGenerated,15)
| render scatterchart 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\Azure Monitor for WVD\Blog-01-03.png&quot; alt=&quot;Registry with values&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Good to know: Sepago’s commercial “Azure Monitor for WVD”  brings the ready to use Azure workbooks for the session and app monitoring and workbooks for the WVD backend:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\Azure Monitor for WVD\Blog-01-07.png&quot; alt=&quot;Registry with values&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>Tue, 05 May 2020 00:00:00 +0200</pubDate>
        <link>/Windows-Virtual-Desktop-Monitoring-the-Spring-backend/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Monitoring-the-Spring-backend/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
        <category>Azure Monitor</category>
        
      </item>
    
      <item>
        <title>Migrate Windows Virtual Desktop Host Pools from Fall to Spring Release - WVD</title>
        <description>&lt;p&gt;The long await update from WVD is public. It comes with a full ARM integration and is natively useable in the Azure Portal. The change from Fall to Spring (the name of both releases) cames without a build-in migration solution right now. You can rebuild your host pools and app groups and manually join your existing session hosts into the new once.&lt;/p&gt;

&lt;p&gt;With WVDAdmin I added two features to do that directly from the GUI:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Migrate a host pool to the Spring update: Creates a new host pool with the same properties as an existing host pool in the Fall update&lt;/li&gt;
  &lt;li&gt;Move session hosts to another host pool*: Works in each direction and from host pool to host poll in the same version (you can use this additionally to remove an assigned user from a session host).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Note: You can only move session hosts from host pool to host pool if you built the session host with WVDAdmin. If not, and you want to use this function with your other deployed session create a folder “ITPC-WVD-PostCustomizing” in C:\ and copy the RDAgent files into this folder and rename the files:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWrmXv&quot;&gt;Microsoft.RDInfra.RDAgent.msi&lt;/a&gt; (rename the file)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWrxrH&quot;&gt;Microsoft.RDInfra.RDAgentBootLoader.msi&lt;/a&gt; (rename the file)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Make sure that you rename the files to fit the list above (without version numbers).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\Migrate-02.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But first: If you are new to WVD Spring update and have never used it before in your subscription, you have to register the service provider Microsoft.DesktopVirtualization (one-time process). You must be the owner of this subscription to do this. Go to your subscription -&amp;gt; Resource providers -&amp;gt; search for “Microsoft.DesktopVirtualization” and click register:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\ResourceProvider.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;the-migration-process&quot;&gt;The migration process&lt;/h2&gt;

&lt;p&gt;The easiest way to migrate a Host Pool from Fall to Spring is by using WVDAdmin. If you have not WVDAdmin before, check out this &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin&quot;&gt;post&lt;/a&gt; .&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Right-click your existing host pool and click: Migrate Host Pool settings to WVD Spring Update&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;ul&gt;
      &lt;li&gt;Select a target subscription and resource group (note: be sure not to mix different host pools in one resource group with app groups having the same name. If you do this, you will see that the migration process cannot migrate this app groups)&lt;/li&gt;
      &lt;li&gt;Select a region: The region saved the meta-data and is independent of the region of your session hosts. There are only limited regions today&lt;/li&gt;
      &lt;li&gt;Enter a name for your new Spring host pool&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Right-click a session host and click “Change host pool” (read my note above, if this host was not created with WVDAdmin)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;ul&gt;
      &lt;li&gt;Select the target host pool. Spring update host pools are tagged with a ²&lt;/li&gt;
      &lt;li&gt;Check “Keep user assignment” if you migrate aa assigned session hosts and want to keep the assignment. If you uncheck this, the user assignment will be repealed&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Repeat the step “Right-click your existing host pool and click: Migrate Host Pool settings to WVD Spring Update” to re-create the icons for your applications. This can only be done if one session host is online&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Give the right user groups permission to the app groups: Click the app group(s) and click the button “Users and groups assignments” and start typing the name of the group(s). Note: I don’t migrate the user permission from the fall update believing that you won’t to add groups instead of single users&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Create a Workspace&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;ul&gt;
      &lt;li&gt;Create a Workspace right-clicking the workspace note. Create a workspace in the same region as your new host pool&lt;/li&gt;
      &lt;li&gt;Right-click the workspace and add/link the app groups you have created&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Move more session hosts to the new host pool&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;ul&gt;
      &lt;li&gt;Right-click the session host note and select “Change host pool”&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;After that, you should see your resources in the native RD client and in the HTML web site which has a new URL: https://rdweb.wvd.microsoft.com/arm/webclient&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;debuggingnotes&quot;&gt;Debugging/notes:&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Moving session host works with host created with WVDAdmin or if you create a folder “ITPC-WVD-PostCustomizing”. Copy the files into it:&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;a href=&quot;https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWrmXv&quot;&gt;Microsoft.RDInfra.RDAgent.msi&lt;/a&gt; (rename the file)&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;a href=&quot;https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWrxrH&quot;&gt;Microsoft.RDInfra.RDAgentBootLoader.msi&lt;/a&gt; (rename the file)&lt;/p&gt;

        &lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\Migrate-02.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;You cannot have app groups with from different host pools with the same name in one resource group&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Register Microsoft.DesktopVirtualization service provider
&lt;img src=&quot;..\assets\images\WVDAdmin\ResourceProvider.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The service principal of WVDAdmin needs owner permission to the resource groups containing the app groups to add/remove users&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The HTML5 client has a new URL: https://rdweb.wvd.microsoft.com/arm/webclient&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;If you “lost” a session host you can add them manually to a host pool by doing:&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;ul&gt;
      &lt;li&gt;Login to the VM&lt;/li&gt;
      &lt;li&gt;Uninstall the RD agent and bootloader&lt;/li&gt;
      &lt;li&gt;Install the bootloader&lt;/li&gt;
      &lt;li&gt;install the agent and copy the registration key for the target host pool into the installation screen&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I record a short video showing the migration process:&lt;/p&gt;

&lt;iframe width=&quot;800&quot; height=&quot;815&quot; src=&quot;https://www.youtube-nocookie.com/embed/pqGsIdFxTs4&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;More details and download: &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin&quot;&gt;WVDAdmin&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And get additional information from &lt;a href=&quot;https://www.linkedin.com/pulse/next-big-innovation-windows-virtual-desktop-here-freek-berson/&quot;&gt;Freek Berson&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Official announcement: &lt;a href=&quot;https://www.microsoft.com/en-us/microsoft-365/blog/2020/04/30/enable-remote-work-faster-new-windows-virtual-desktop-capabilities/&quot;&gt;https://www.microsoft.com/en-us/microsoft-365/blog/2020/04/30/enable-remote-work-faster-new-windows-virtual-desktop-capabilities/&lt;/a&gt;&lt;/p&gt;

</description>
        <pubDate>Mon, 04 May 2020 00:00:00 +0200</pubDate>
        <link>/Windows-Virtual-Desktop-Migrate-from-Fall-to-Spring/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Migrate-from-Fall-to-Spring/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
      <item>
        <title>Windows Virtual Desktop - Spring Release / Spring Update with WVDAdmin</title>
        <description>&lt;p&gt;Windows Virtual Desktop - Spring Release / Spring Update goes public today. I’m tremendously happy about that while this is the next big step that we have eagerly awaited.&lt;/p&gt;

&lt;p&gt;The spring release gives us some feature and changes that make it even easier to deploy apps and desktops to users:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Add groups instead of users to desktops and apps&lt;/li&gt;
  &lt;li&gt;Full integration of the administration of WVD in the Azure Portal&lt;/li&gt;
  &lt;li&gt;Using a native ARM deployment instead of the WVD tenant API&lt;/li&gt;
  &lt;li&gt;Linking app groups and desktops into workspaces&lt;/li&gt;
  &lt;li&gt;and a lot of more things&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Even the administration of WVD was missing before. This was one reason to build WVDAdmin. I was often asked in the past if WVDAdmin will be unnecessary after the spring release of WVD. My answer: Sure, for the administration, WVDAdmin will not be that important anymore, but some features still add value. That’s why I decided months ago to develop WVDAdmin further and also prepare it for the “Spring Release”. So I am proud to announce that WVDAdmin is ready for the Spring Release starting with the already available version 1.5.&lt;/p&gt;

&lt;p&gt;To enable the Spring Release feature set a registry key (the current version will have this enabled by default):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;HKCU\Software\ITProCloud\WVDAdmin

(Reg_DWord) &quot;FeatureSet&quot; = 1
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\SpringReleaseRegistry.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;First, register the new service provide Microsoft.DesktopVirtualization on your Azure subscription (one-time process). You must be owner of this subscription to do this. Go to your subscription -&amp;gt; Resource providers -&amp;gt;  search for “Microsoft.DesktopVirtualization” and click register:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\ResourceProvider.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you restart WVDAdmin you will see the new note “WVD V2” which displays your resources in the Spring Release. Please make sure that your service principal has the right permission to create and administrate your resources (the sp needs owner permission to the resource group containing your host pool, app groups, … to assign users and groups).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\SpringReleaseGui.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But what can you do with WVDAdmin compared to the portal integration? You can (e.g.):&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Administrate all resources with a Windows GUI&lt;/li&gt;
  &lt;li&gt;Create “golden images” from template/master VMs&lt;/li&gt;
  &lt;li&gt;Rollout several session hosts into differents host pools (in both WVD releases)&lt;/li&gt;
  &lt;li&gt;Re-use you created WVDAdmin images without any change&lt;/li&gt;
  &lt;li&gt;Higher flexibility rolling out new session hosts in different ways (you can use different VMSizes and images in one host pool)&lt;/li&gt;
  &lt;li&gt;Easy to use user administration to send messages, logoff, disconnect or shadowing users over the full environment (filterable)&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;From an architectural perspective, the “Spring Update” is really close to the previews release. But there are a few differences:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;WVD tenant and tenant groups are no longer used&lt;/li&gt;
  &lt;li&gt;“Workspaces” summarize multiple apps and desktop groups. These apps and desktops are shown in the client grouped by workspaces&lt;/li&gt;
  &lt;li&gt;All resources like host pools, app groups are ARM resources in the Azure portal.&lt;/li&gt;
  &lt;li&gt;App groups must be in the same region as the host pools&lt;/li&gt;
  &lt;li&gt;A Workspace can group apps and desktop groups in the same region&lt;/li&gt;
  &lt;li&gt;The regions of the session hosts are completely independent of the regions of the host pools (which is great)&lt;/li&gt;
  &lt;li&gt;Today you have only a few regions to roll out host pools and workspaces (which is not so important because you can rollout the   session hosts in any region)&lt;/li&gt;
  &lt;li&gt;And you can assign groups to apps and desktops&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\SpringReleaseVSWVD.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Check out my video rolling out session hosts from an existing WVD image into the spring update (sorry for the bad sound - I will change this later):&lt;/p&gt;

&lt;iframe width=&quot;800&quot; height=&quot;815&quot; src=&quot;https://www.youtube-nocookie.com/embed/Nb97VBiNQLI&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;More details and download: &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin&quot;&gt;WVDAdmin&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And get additional information from &lt;a href=&quot;https://www.linkedin.com/pulse/next-big-innovation-windows-virtual-desktop-here-freek-berson/&quot;&gt;Freek Berson&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Official announcement: &lt;a href=&quot;https://www.microsoft.com/en-us/microsoft-365/blog/2020/04/30/enable-remote-work-faster-new-windows-virtual-desktop-capabilities/&quot;&gt;https://www.microsoft.com/en-us/microsoft-365/blog/2020/04/30/enable-remote-work-faster-new-windows-virtual-desktop-capabilities/&lt;/a&gt;&lt;/p&gt;

</description>
        <pubDate>Thu, 30 Apr 2020 00:00:00 +0200</pubDate>
        <link>/Windows-Virtual-Desktop-Spring-Update,-Spring-Release/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Spring-Update,-Spring-Release/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
      <item>
        <title>Using Azure AD groups to assign users to Windows Virtual Desktop (WVD)</title>
        <description>&lt;p&gt;Today (early April), it’s not possible to join groups to application groups or desktop in Windows Virtual Desktop. Users have to be assigned directly with their user principal name (UPN). With &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin&quot;&gt;WVDAdmin&lt;/a&gt;, you can do this by entering or copying the UPN’s into a text field.&lt;/p&gt;

&lt;p&gt;From Version 1.4.7 you have another option: You can now browse the Azure AD for users AND groups to add them.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\AadBrowser-01.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you have added users and groups with the new function, &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin&quot;&gt;WVDAdmin&lt;/a&gt; will fill out the text field with the UPN’s of the selected users and group members (only members, no external accounts).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\AadBrowser-02.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This function doesn’t resolve the missing function in the WVD but can give you an easier way to handle this until the function is integrated into WVD itself.&lt;/p&gt;

&lt;p&gt;Requirement: The service principal needs permission to browse the Azure Active directory. To do this go to the Azure Portal -&amp;gt; Active Directory -&amp;gt; App Registration -&amp;gt; Select your Service Principal -&amp;gt; API Permissions
Add the permission “Azure Active Directory Graph” -&amp;gt; Application Permission -&amp;gt; Directory.Read.All&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\SP-PermissionToReadDirectoryObjects-01.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To be read for the &lt;em&gt;WVD Spring Update&lt;/em&gt; you have to give the service principal access to the Graph API: Add the permission “Microsoft Graph” -&amp;gt; Application Permission -&amp;gt; Directory.Read.All&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\SP-PermissionToReadDirectoryObjects-01b.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To consent the permission and administrator of Azure AD have to grant this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDAdmin\SP-PermissionToReadDirectoryObjects-02.png&quot; alt=&quot;AADBrowser&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Tue, 07 Apr 2020 00:00:00 +0200</pubDate>
        <link>/Windows-Virtual-Desktop-Add-Users-and-Groups-to-WVD/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Add-Users-and-Groups-to-WVD/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
      <item>
        <title>WVD Admin - A native administration Gui for Windows Virtual Desktop - Preview Version</title>
        <description>&lt;p&gt;Feel free to use it and download the 64-bit Windows application “WVD Admin Preview” from here: &lt;a href=&quot;../assets/files/WVDAdmin-Preview.msi&quot;&gt;WVDAdmin-Preview.msi&lt;/a&gt;&lt;/p&gt;

</description>
        <pubDate>Wed, 26 Feb 2020 00:00:00 +0100</pubDate>
        <link>/Windows-Virtual-Desktop-Admin-Preview/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Admin-Preview/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
      <item>
        <title>Windows Virtual Desktop and Language Packs - Detecting Host Pool and Tenant Name issue</title>
        <description>&lt;p&gt;Language packs on Windows sometimes cause some issues or strange behaviors to some applications. One problem I can reproduce is the impact of the RDAgent from Microsoft - the agent running on a WVD session host, which makes the connection to the WVD backend.
If no language pack is installed (or not set as the system language), the RDAgent writes some information to the registry naming the Host Pool, Tenant, and more. You can find this data in &lt;strong&gt;HKLM:\SOFTWARE\Microsoft\RDMonitoringAgent&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The RDAgent writes this data at least if the session host at the start:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVD.LanguagePack.RDMonitoringAgent.01.png&quot; alt=&quot;Registry with values&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you have a clean Windows Virtual Machine with an &lt;strong&gt;installed&lt;/strong&gt; and for the whole system activated &lt;strong&gt;language pack&lt;/strong&gt; and if you then install the RDAgent, this information is never written to the registry (the WVD function itself is working as expected).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVD.LanguagePack.RDMonitoringAgent.02.png&quot; alt=&quot;Registry with values&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you use this Virtual Machine - or session hosts you built based on this VM - you can no longer detect the WVD-tenant, host pool name from the registry. These also affect my tools using this information:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://loganalytics.sepago.com/&quot;&gt;Azure Monitor for WVD&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/MarcelMeurer/Project-MySmartScale&quot;&gt;Azure Autoscale for WVD&lt;/a&gt; (aka “Project MySmartScale”, WorkerAgent)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;They reference the data to an “unknown” or “staging” host pool path (host pool path is “tenant.hostpool” name). This behavior can lead to misinterpretations.&lt;/p&gt;

&lt;p&gt;To work-around this peculiar behavior with language packs, I added a new function to both solutions. If the tenant and host pool name can not be discovered by using the registry keys, the agents read the tag “WVD.Path” to get the names. The value in WVD.Path must be in the format: TenantName\TenantGroupName\HostPoolName:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVD.LanguagePack.RDMonitoringAgent.03.png&quot; alt=&quot;Tags&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The new agents are ready to download:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://loganalytics.sepago.com/download.html&quot;&gt;Azure Monitor for WVD&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/MarcelMeurer/Project-MySmartScale/tree/master/bin&quot;&gt;Azure Autoscale for WVD&lt;/a&gt; (aka “Project MySmartScale”, WorkerAgent)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Additionally,  &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin&quot;&gt;WVDAdmin&lt;/a&gt; (from version 1.3.6) will tag new distributed session hosts automatically.&lt;/p&gt;
</description>
        <pubDate>Sun, 23 Feb 2020 00:00:00 +0100</pubDate>
        <link>/Windows-Virtual-Desktop-Language-Packs-Detecting-Host-Pool-and-Tenant-Name/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Language-Packs-Detecting-Host-Pool-and-Tenant-Name/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
      <item>
        <title>Windows Virtual Desktop - Azure Starter for WVD</title>
        <description>&lt;p&gt;This month I started to build my fourth tool around Microsoft Windows Virtual Desktop. This new one, called “Azure Starter for WVD” is a self-service portal for users using WVD. In this portal, which is a web app with Azure AD authentication, users can start and stop (deallocate) their personal assigned session host - which in this case are VDIs.&lt;/p&gt;

&lt;p&gt;The user doesn’t need access nor permission to the Azure portal or the virtual machines. The authentication of the web app handles the action itself.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;..\assets\images\WVDStarter-AssignedUser.png&quot; alt=&quot;MySmartScale-01&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The newest implementation adds a new feature: You can configure that running VMs are deallocated if no user is logged in. That handles in combination with a group policy that personally assigned session hosts to go down after a specific time of idling.&lt;/p&gt;

&lt;p&gt;A session host can be assigned to a specific user using my admin GUI for WVD: &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin&quot;&gt;WVDAdmin&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Go to the documentation and deploy this free solution to Azure:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/MarcelMeurer/Azure-Starter-for-WVD&quot;&gt;https://github.com/MarcelMeurer/Azure-Starter-for-WVD&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Sun, 09 Feb 2020 00:00:00 +0100</pubDate>
        <link>/Windows-Virtual-Desktop-Azure-Starter-for-WVD/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Azure-Starter-for-WVD/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
      <item>
        <title>Using WVDAdmin for Windows Virtual Desktop in 2-AAD-Environment (Microsoft Demo Case)</title>
        <description>&lt;h1 id=&quot;using-azure-starter-for-windows-virtual-desktop-in-2-aad-environment-microsoft-demo-case&quot;&gt;Using Azure Starter for Windows Virtual Desktop in 2-AAD-Environment (Microsoft Demo Case)&lt;/h1&gt;

&lt;p&gt;Usually, the WVD tenant and the resources (sessions hosts) are in the same AAD tenant. If you have two Azure AD tenant, you can use WVDAdmin with a second service principal to access the session hosts.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Azure AD 1 - “&lt;em&gt;my-msft.onMicrosoft.com&lt;/em&gt;“&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;Your personal AAD where you have your users, an AD-Controller, AD-Connect (or AD domain services), and other resources. In this AAD you have deployed your WVD tenant.&lt;/li&gt;
      &lt;li&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Azure AD 2 - “&lt;em&gt;microsoft.onMicrosoft.com&lt;/em&gt;“&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;You have no high-level permission to the AAD because it’s own by your company and shared with many other users/professionals. In this AAD, you have a subscription (AIR) containing your session hosts.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/WVDAdmin/Split-AAD-02.png&quot; alt=&quot;Split-AAD-02.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Create the &lt;strong&gt;first service principal&lt;/strong&gt; in “my-msft.onMicrosoft.com”. Configure this service principal as described in the primary guide - except permitting to the resource group containing the session hosts and the vnet (these are in the other tenant). Use the data of this service principal in the welcom dialog of WVDAdmin.&lt;/p&gt;

&lt;p&gt;Create the &lt;strong&gt;second service principal&lt;/strong&gt; in “microsoft.onMicrosoft.com”. Give the service principal contributor permission to the resource group containing the session hosts and to the vnet for the session host. Open the registry and navigate to &lt;em&gt;HKEY_CURRENT_USER\Software\ITProCloud\WVDAdmin&lt;/em&gt;. Add three string value to configure the service principal to access the resource groups&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;AzResAlternativeTenantId&lt;/li&gt;
  &lt;li&gt;AzResAlternativeAppId&lt;/li&gt;
  &lt;li&gt;AzResAlternativeAppSecret&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/WVDAdmin/Split-AAD-03.png&quot; alt=&quot;Split-AAD-03.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you use another tenant group name as “Default Tenant Group” add another string “TenantGroupName” and set your tenant group name.&lt;/p&gt;

&lt;p&gt;This solution is supported from the current version 1.3.3&lt;/p&gt;

&lt;p&gt;Read more and download WVDAdmin on &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/&quot;&gt;the main page&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Fri, 07 Feb 2020 00:00:00 +0100</pubDate>
        <link>/Windows-Virtual-Desktop-Admin-for-2-tenant-mode/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Admin-for-2-tenant-mode/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
      <item>
        <title>WVD Admin - Windows Virtual Desktop Administration for CSP and Consulting Partners</title>
        <description>&lt;h1 id=&quot;windows-virtual-desktop-administration-for-csp-and-consulting-partners&quot;&gt;Windows Virtual Desktop Administration for CSP and Consulting Partners&lt;/h1&gt;

&lt;p&gt;Last year I released my windows-based GUI for administrating WVD to the community called WVDAdmin. I had a bunch of updates to share more features. This week I will release version 1.3.0 with will add another feature, especially for providers and consulting companies. From version 1.3.0 WVDAdmin will support a multi-AAD-tenancy mode allowing to switch the Azure AD tenant very easily.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/WVDAdmin.MultiTenancy/WVDAdmin.Welcome.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;To enable the multi-AAD-tenancy mode, you must set a registry key. Add the following dword32 to your registry:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-registry&quot;&gt;HKEY_CURRENT_USER\Software\ITProCloud\WVDAdmin
Name:	AadMultiTenant
Type:	DWORD32
Value:	1 (or 0 to disable this mode)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/WVDAdmin.MultiTenancy/Registry1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you start WVDAdmin with this setting, a drop-down list will be visible at the welcome screen (see above). If you save a new service principal configuration, it happens to the drop-down list with the friendly name.
All other settings for the image creation or rollout of new session hosts are saved to the context of the selected AAD tenant.&lt;/p&gt;

&lt;p&gt;The authentication settings and other settings are saved in different trees in the registry starting from &lt;em&gt;HKEY_CURRENT_USER\Software\ITProCloud\WVDAdmin\AadMultiTenant&lt;/em&gt;
If you had already used WVDAdmin in the “normal” mode, you could copy the settings from the root of the registry path to the new path for your AAD tenant. To delete a no longer needed AAD-tenant in WVDAdmin, remove the registry key of this one.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/WVDAdmin.MultiTenancy/Registry2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Don’t change&lt;/strong&gt; the AAD tenant while an operation is in progress. This could result in an error. If you change the AAD tenant, click “Reload all” to read the configuration for the new tenant.&lt;/p&gt;

&lt;p&gt;The AAD multi-tenancy mode helps a lot if you have (like me) multiple clients you are working with.&lt;/p&gt;

&lt;p&gt;Feel free to use it and download the 64-bit Windows application “WVD Admin” from here: &lt;a href=&quot;../assets/files/WVDAdmin.msi&quot;&gt;WVDAdmin Preview&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Read the original blog post about WVDAdmin here: &lt;a href=&quot;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin/&quot;&gt;https://blog.itprocloud.de/Windows-Virtual-Desktop-Admin&lt;/a&gt;&lt;/p&gt;

</description>
        <pubDate>Tue, 28 Jan 2020 00:00:00 +0100</pubDate>
        <link>/Windows-Virtual-Desktop-Windows-Virtual-Desktop-Administration-for-CSP-and-Consulting-Partners/</link>
        <guid isPermaLink="true">/Windows-Virtual-Desktop-Windows-Virtual-Desktop-Administration-for-CSP-and-Consulting-Partners/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
      <item>
        <title>Automatic MSIX App Attach script for Windows Virtual Desktop</title>
        <description>&lt;h1 id=&quot;automatic-msix-app-attach-script-for-wvd&quot;&gt;Automatic MSIX App Attach script for WVD&lt;/h1&gt;

&lt;p&gt;Microsoft provides a preview of MSIX app attach for Windows Virtual desktop. MSIX app attach gives you the possibility to only have a few amounts of images and connect your application to them - without installing. That sounds a little bit like App-V, and from a user perspective, this is slightly comparable:&lt;/p&gt;

&lt;p&gt;You cannot see the application in the file system from outside the app. If you open the app and if you browse to the application folder, you can see this folder. The attaching and links in the start menu “feels” like the use of modern apps from the marketplace. And indeed: The application links in the start menu didn’t refer to the exe-files in the program folder.&lt;/p&gt;

&lt;h2 id=&quot;configuration-of-the-msix-packages-and-assignments&quot;&gt;Configuration of the MSIX packages and assignments&lt;/h2&gt;

&lt;p&gt;If you are in the Windows Insider program, you can test MSIX app attach in a WVD environment. To do this go to the web site &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/virtual-desktop/app-attach&quot;&gt;https://docs.microsoft.com/en-us/azure/virtual-desktop/app-attach&lt;/a&gt; which explains the process of preparing your Windows insider image and how to stage and register MSIX apps for session hosts und users. If you convert legacy apps to MSIX I recommend the YouTube video of &lt;a href=&quot;https://twitter.com/MSAzureAcademy&quot;&gt;@MSAzureAcademy&lt;/a&gt;: &lt;a href=&quot;https://www.youtube.com/watch?v=6kkPLFgPaN8&quot;&gt;https://www.youtube.com/watch?v=6kkPLFgPaN8&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Microsoft gives you example scripts to stage, un-stage, register, and un-register MSIX apps. For each app, you have to build these four scripts. While the scrips only differ in a few points, I decided to create one script which does the necessary things for all apps I want to provide.&lt;/p&gt;

&lt;p&gt;The result is one folder containing a single PowerShell script and a configuration file for my MSIX apps. The structure of the configuration is JSON:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;apps&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;vhdSrc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ads01&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Configuration&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;WVD&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;MSIX&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;NotepadPP.vhd&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;volumeGuid&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;9c371391-0000-0000-0000-010000000000&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;packageName&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;notepadpp_7.8.1.0_x64__cqx7y23m1rjgy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;parentFolder&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MSIX-Apps&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sessionTarget&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;hostPools&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MSIX-Builder&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;userGroups&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SW_WVD_All&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SW_WVD_NotePadPP&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;vhdSrc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ads01&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Configuration&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;WVD&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;MSIX&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;FileZilla.vhd&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;volumeGuid&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2ac99dec-0000-0000-0000-010000000000&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;packageName&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;filezilla_3.45.1.0_x64__cqx7y23m1rjgy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;parentFolder&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MSIX-Apps&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sessionTarget&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;hostPools&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MSIX-Builder&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;userGroups&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SW_WVD_All&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SW_WVD_FileZilla&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;​&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For each application, you have to define the following properties:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Property&lt;/th&gt;
      &lt;th&gt;Note&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;vhdSrc&lt;/td&gt;
      &lt;td&gt;Path to the expanded MSIX app (as vhd)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;volumeGuid&lt;/td&gt;
      &lt;td&gt;Guid of the vhd&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;packageName&lt;/td&gt;
      &lt;td&gt;Name of the MSIX app attach package&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;parentFolder&lt;/td&gt;
      &lt;td&gt;Root folder name in your vhd&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;hostPools&lt;/td&gt;
      &lt;td&gt;List of host pool names where the package should be applied&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;userGroups&lt;/td&gt;
      &lt;td&gt;List of AD groups: Members get the application linked in their start menu&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;providing-the-script-to-users-and-session-hosts&quot;&gt;Providing the script to users and session hosts&lt;/h2&gt;

&lt;p&gt;Provide the script AppAttach with the configuration in a folder of a shared network drive. This folder must be readable for all users.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/MSIX-AppAttach-Script/Image-01.png&quot; alt=&quot;Image-01&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Refer this file by a group policy:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Computer Configuration - Policies - Windows Settings - Scripts - Startup&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Name:        %windir%\System32\WindowsPowerShell\v1.0\powershell.exe&lt;/p&gt;

&lt;p&gt;Parameter:    -ExecutionPolicy Unrestricted -File \ads01\Configuration\WVD\MSIX\AppAttach.ps1 -ConfigFile \\ads01\Configuration\WVD\MSIX\AppAttach.json -Mode VmStart&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Computer Configuration - Policies - Windows Settings - Scripts - Shutdown&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Name:        %windir%\System32\WindowsPowerShell\v1.0\powershell.exe&lt;/p&gt;

&lt;p&gt;Parameter:    -ExecutionPolicy Unrestricted -File \ads01\Configuration\WVD\MSIX\AppAttach.ps1 -ConfigFile \\ads01\Configuration\WVD\MSIX\AppAttach.json -Mode VmShutdown&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;User Configuration - Policies - Windows Settings - Scripts - Logon&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Name:        %windir%\System32\WindowsPowerShell\v1.0\powershell.exe&lt;/p&gt;

&lt;p&gt;Parameter:    -ExecutionPolicy Unrestricted -File \ads01\Configuration\WVD\MSIX\AppAttach.ps1 -ConfigFile \ads01\Configuration\WVD\MSIX\AppAttach.json -Mode UserLogon&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;User Configuration - Policies - Windows Settings - Scripts - Logoff&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Name:        %windir%\System32\WindowsPowerShell\v1.0\powershell.exe&lt;/p&gt;

&lt;p&gt;Parameter:    -ExecutionPolicy Unrestricted -File \ads01\Configuration\WVD\MSIX\AppAttach.ps1 -ConfigFile \\ads01\Configuration\WVD\MSIX\AppAttach.json -Mode UserLogoff&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Where \\ads01\Configuration\WVD\MSIX\ is the path to the script and \\ads01\Configuration\WVD\MSIX\AppAttach.json the JSON-configuration file.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Make sure that the GPO is linked to the computer and enable loopback processing:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Computer Configuration - Policies - Administrative Templates - System/Group Policy&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Configure user Group Policy loopback processing mode: Enable - Mode: merge.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/MSIX-AppAttach-Script/Image-02.png&quot; alt=&quot;Image-02&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;preparing-the-golden-master-for-the-session-hosts&quot;&gt;Preparing the golden master for the session hosts&lt;/h2&gt;

&lt;p&gt;To work with MSIX and have the script do the work you have to prepare your golden image:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Make sure that you have installed the right version from the insider build&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Double-check that you have &lt;strong&gt;NOT&lt;/strong&gt; prepared your image with the command line commands described in &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/virtual-desktop/app-attach#prepare-the-vhd-image-for-azure&quot;&gt;https://docs.microsoft.com/en-us/azure/virtual-desktop/app-attach#prepare-the-vhd-image-for-azure&lt;/a&gt; (Disable Store auto-update and so on). It’s only for the VM concerning the converting process.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Copy the PSTools &lt;a href=&quot;https://docs.microsoft.com/en-us/sysinternals/downloads/psexec&quot;&gt;https://docs.microsoft.com/en-us/sysinternals/downloads/psexec&lt;/a&gt; to %Windir%\System32 (you need psexec later)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Give the service GPSVC the right privileges to mount images:&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;Create a cmd-file with this content:&lt;/p&gt;

        &lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;sc privs gpsvc SeManageVolumePrivilege/SeTcbPrivilege/SeTakeOwnershipPrivilege/SeIncreaseQuotaPrivilege/SeAssignPrimaryTokenPrivilege/SeSecurityPrivilege/SeChangeNotifyPrivilege/SeCreatePermanentPrivilege/SeShutdownPrivilege/SeLoadDriverPrivilege/SeRestorePrivilege/SeBackupPrivilege/SeCreatePagefilePrivilege
&lt;/code&gt;&lt;/pre&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;Open an administrative cmd and execute:&lt;/p&gt;

        &lt;p&gt;psexec /s cmd&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;In this service cmd execute the cmd-file to give GPSVC the right  permissions&lt;/p&gt;

        &lt;p&gt;(This adds the SeManageVolumePrivilege which allows mounting of images)&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/MSIX-AppAttach-Script/Image-03.png&quot; alt=&quot;Image-03&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you have this done, you can rollout several session hosts (or start with one for testing). If you now log on with different users, each user will see its assigned applications.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/images/MSIX-AppAttach-Script/Image-04.png&quot; alt=&quot;Image-04&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Note: If a user logoff the application will be de-registered except if the user an administrator (this will be skipped to avoid unmounting the app package).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;../assets/files/AutoUpdate/Scripts/AppAttach.ps1.txt&quot;&gt;Download&lt;/a&gt; the script and rename it to AppAttach.ps1&lt;/strong&gt;&lt;/p&gt;

</description>
        <pubDate>Sun, 01 Dec 2019 00:00:00 +0100</pubDate>
        <link>/Automatic-MSIX-app-attach-scripts/</link>
        <guid isPermaLink="true">/Automatic-MSIX-app-attach-scripts/</guid>
        
        
        <category>Windows Virtual Desktop</category>
        
      </item>
    
  </channel>
</rss>
