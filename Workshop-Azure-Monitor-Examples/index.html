<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logos/icon.png">

<title>Workshop Azure Monitor - Lessons | ITProCloud Blog</title>

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Workshop Azure Monitor - Lessons | ITProCloud Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Workshop Azure Monitor - Lessons" />
<meta name="author" content="mm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="To get practice in using Azure Monitor, I have prepared some examples. These examples can be recreated with a little PowerShell. I have prepared more complex program parts. These can be found in the “Tools” folder. Finished solutions are stored in the folder “Samples”." />
<meta property="og:description" content="To get practice in using Azure Monitor, I have prepared some examples. These examples can be recreated with a little PowerShell. I have prepared more complex program parts. These can be found in the “Tools” folder. Finished solutions are stored in the folder “Samples”." />
<meta property="og:site_name" content="ITProCloud Blog" />
<meta property="og:image" content="/assets/images/AzureMonitor-Lessons.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-09-21T00:00:00+02:00" />
<script type="application/ld+json">
{"url":"/Workshop-Azure-Monitor-Examples/","headline":"Workshop Azure Monitor - Lessons","dateModified":"2019-09-21T00:00:00+02:00","datePublished":"2019-09-21T00:00:00+02:00","author":{"@type":"Person","name":"mm"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logos/itpc-logo-bottom-text.png"},"name":"mm"},"image":"/assets/images/AzureMonitor-Lessons.png","description":"To get practice in using Azure Monitor, I have prepared some examples. These examples can be recreated with a little PowerShell. I have prepared more complex program parts. These can be found in the “Tools” folder. Finished solutions are stored in the folder “Samples”.","mainEntityOfPage":{"@type":"WebPage","@id":"/Workshop-Azure-Monitor-Examples/"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<!--- cookie banner --->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />

<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-page">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logos/itpc-logo-bottom-text.png" alt="ITProCloud Blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Home</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="#allTags">Show all tags</a>
                </li>
	
				
				
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-WebApp">Azure WebApp (3)</a>
						</li>
						
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-VM">Azure VM (2)</a>
						</li>
						
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#PowerShell">PowerShell (7)</a>
						</li>
						
					
				
								

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://twitter.com/MarcelMeurer"><i class="fab fa-twitter"></i></a>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.linkedin.com/in/marcel-meurer-15b46b98"><i class="fab fa-linkedin"></i></a>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/MarcelMeurer"><i class="fab fa-github"></i></a>
                </li>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="mailto:marcel.meurer@sepago.de?subject=Request%20from%20ITProCloud.de"><i class="far fa-envelope"></i></a>
                </li>


                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">ITProCloud Blog</h1>
    <p class="lead">
        This is my personal website, which I maintain to support the cloud community. ITProCloud.de is the label I use for tests and demonstrations. ITProCloud.de is not a company in the business sense.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <section>
    <div class="section-title">
        <h2><span>Workshop Azure Monitor - Lessons</span></h2>
    </div>

    <div class="article-post">
    <p>To get practice in using Azure Monitor, I have prepared some examples. These examples can be recreated with a little PowerShell. I have prepared more complex program parts. These can be found in the “Tools” folder. Finished solutions are stored in the folder “Samples”.</p>

<p>GitHub: <a href="https://github.com/MarcelMeurer/Workshop-AzureMonitor">https://github.com/MarcelMeurer/Workshop-AzureMonitor</a></p>

<h3 id="in-the-tools-folder-there-are-the-following-scripts">In the Tools folder there are the following scripts:</h3>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">.</span><span class="nf">/Add-AzureMonitorData.ps1</span><span class="w"> </span><span class="nt">-WorpspaceId</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">WorkSpaceId</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-WorpspaceKey</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">WorpspaceKey</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-LogTypeName</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">LogTypeName</span><span class="err">&gt;</span><span class="w"> </span><span class="p">[</span><span class="nt">-TimeStampField</span><span class="w"> </span><span class="err">&lt;</span><span class="kt">TimeStampField</span><span class="err">&gt;</span><span class="p">]</span><span class="w"> </span><span class="nt">-JsonData</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">JsonData</span><span class="err">&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Send jsonData to the Log Analytics workspace into the given LogTyeName. TimeStampField is not mandatory. If given, it must be the name of the field containing the timestamp of each data set.</p>

<h2 id="missions">Missions</h2>

<h3 id="store-information-about-the-running-processes-from-your-computer">Store information about the running processes from your computer</h3>

<p>Collect the process information from your computer each 30 seconds and send these data to your Log Analytics workspace. Use PowerShell to automate this mission.</p>

<p>Select an app and use this app  to “overload” your CPU.</p>

<p>If data are visible in Log Analytics, build a custom dashboard by using “Log” to query the data.</p>

<ul>
  <li>
    <p>Find out:</p>

    <ul>
      <li>Count of distinct processes</li>
      <li>Average CPU load over time (all processes). Render a time chart</li>
      <li>Render a time chart for the app you used to overload the CPU</li>
    </ul>
  </li>
  <li>
    <p>Some useful PowerShell commands:</p>
  </li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c">#Get cpu consumption by process</span><span class="w">
</span><span class="p">(</span><span class="nf">Get-Counter</span><span class="w"> </span><span class="s2">"\process(*)\% Processor Time"</span><span class="p">)</span><span class="o">.</span><span class="nf">CounterSamples</span><span class="w">

</span><span class="c">#Convert objects to </span><span class="w">
</span><span class="nv">$json</span><span class="o">=</span><span class="nv">$object</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">ConvertTo-Json</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="store-temperature-data-for-multiple-cities">Store temperature data for multiple cities</h3>

<p>Collect data from OpenWeatherMap for three different cities each 30 seconds. Send the data to your Log Analytics workspace using Add-AzureMonitorData.ps1. Use PowerShell to automate this mission.</p>

<p>If data are visible in Log Analytics, build a custom dashboard using the View Designer within Log Analytics. Build:</p>

<ul>
  <li>One overview tile showing the number of the different cities</li>
  <li>Two dashboards showing the temperature and humidity as a chart and as a list per city</li>
  <li>Connect PowerBi Dekstop to your data: Display Line Charts and use a selector/filter for the cities (drop down field)</li>
</ul>

<p>Hints:</p>

<ul>
  <li>
    <p>Collect data from OpenWeatherMap</p>

    <ul>
      <li>https://openweathermap.org/</li>
      <li>Create an account and api key</li>
      <li>Test your key (it can take some minutes):
 https://api.openweathermap.org/data/2.5/weather?q=Bonn&amp;APIKEY=xxxxxxx</li>
    </ul>
  </li>
  <li>
    <p>Some useful PowerShell commands:</p>
  </li>
</ul>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c">#Endless-loop</span><span class="w">
</span><span class="kr">do</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="kr">while</span><span class="w"> </span><span class="p">(</span><span class="bp">$true</span><span class="p">)</span><span class="w">

</span><span class="c">#Sleep $n seconds</span><span class="w">
</span><span class="nf">sleep</span><span class="w"> </span><span class="nv">$n</span><span class="w">

</span><span class="c">#make a http request</span><span class="w">
</span><span class="nf">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">GET</span><span class="w"> </span><span class="nt">-ContentType</span><span class="w"> </span><span class="s2">"application/json"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="build-your-own-log-writer-function">Build your own log-writer function</h3>

<p>Build a log-writer function for your own PowerShell scripts using Log Analytics. There are some request to your solution:</p>

<ul>
  <li>Have the following columns:
    <ul>
      <li>TimeStamp (as TimeGeneratedField)</li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>Serverity (Debug</td>
              <td>Information</td>
              <td>Warning</td>
              <td>Error)</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>Message (Text)</li>
      <li>ScriptName (Name of the script using your function)</li>
    </ul>
  </li>
</ul>

    </div>

    
</section>
</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div id="allTags" class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore by tags <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Azure-WebApp">Azure WebApp (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-VM">Azure VM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PowerShell">PowerShell (7)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Monitor">Azure Monitor (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Log-Analytics">Log Analytics (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-AD">Azure AD (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OneDrive">OneDrive (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-IoT">Azure IoT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Functions">Azure Functions (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Marketplace">Azure Marketplace (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Windows-Virtual-Desktop">Windows Virtual Desktop (8)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Events">Events (2)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-5 col-sm-5 text-center text-lg-left">
                Copyright © 2020 ITProCloud Blog 
            </div>
            <div class="col-md-4 col-sm-4 text-center text-lg-left">
                <a href="/Impressum">Impressum/Imprint</a> - 
                <a href="/privacyDe">Datenschutz</a> - 
				<a href="/privacyEn">Privacy</a>
            </div>
            <div class="col-md-3 col-sm-3 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 



<!-- Start Cookie Plugin -->
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eaf7f7",
      "text": "#5c7291"
    },
    "button": {
      "background": "#56cbdb",
      "text": "#ffffff"
    }
  },
  "position": "bottom-right",
  "content": {
    "message": 'This website uses cookies to ensure you get the best experience on our website.<br/><a href="/privacyEn">Privacy policy</a><br/><br/>Diese Website verwendet Cookies, um dir mehr Benutzerfreundlichkeit zu bieten. Mit der Nutzung dieser Website stimmst du der Verwendung von Cookies zu.<br/><a href="/privacyDe">Datenschutzerklärung</a><br/><br/> ',
    "href": "/privacyEn"
  }
});
</script>
<!-- End Cookie Plugin -->

</body>
</html>
