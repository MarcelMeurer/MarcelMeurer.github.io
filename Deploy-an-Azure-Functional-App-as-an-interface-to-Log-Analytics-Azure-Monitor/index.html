<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logos/icon.png">

<title>Deploy an Azure Functional App as an interface to Log Analytics / Azure Monitor | ITProCloud Blog</title>

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Deploy an Azure Functional App as an interface to Log Analytics / Azure Monitor | ITProCloud Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Deploy an Azure Functional App as an interface to Log Analytics / Azure Monitor" />
<meta name="author" content="mm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction" />
<meta property="og:description" content="Introduction" />
<meta property="og:site_name" content="ITProCloud Blog" />
<meta property="og:image" content="/wp-content/uploads/2019/01/StreamAnalytics-Query-1024x395.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-13T00:00:00+01:00" />
<script type="application/ld+json">
{"url":"/Deploy-an-Azure-Functional-App-as-an-interface-to-Log-Analytics-Azure-Monitor/","headline":"Deploy an Azure Functional App as an interface to Log Analytics / Azure Monitor","dateModified":"2019-01-13T00:00:00+01:00","datePublished":"2019-01-13T00:00:00+01:00","author":{"@type":"Person","name":"mm"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logos/itpc-logo-bottom-text.png"},"name":"mm"},"image":"/wp-content/uploads/2019/01/StreamAnalytics-Query-1024x395.png","description":"Introduction","mainEntityOfPage":{"@type":"WebPage","@id":"/Deploy-an-Azure-Functional-App-as-an-interface-to-Log-Analytics-Azure-Monitor/"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

<!--- cookie banner --->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />

<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logos/itpc-logo-bottom-text.png" alt="ITProCloud Blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Home</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="#allTags">Show all tags</a>
                </li>
	
				
				
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-WebApp">Azure WebApp (3)</a>
						</li>
						
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#Azure-VM">Azure VM (2)</a>
						</li>
						
					
						<li class="nav-item">
						<a class="nav-link" href="/categories#PowerShell">PowerShell (7)</a>
						</li>
						
					
				
								

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://twitter.com/MarcelMeurer"><i class="fab fa-twitter"></i></a>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.linkedin.com/in/marcel-meurer-15b46b98"><i class="fab fa-linkedin"></i></a>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/MarcelMeurer"><i class="fab fa-github"></i></a>
                </li>
                </li>
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="mailto:marcel.meurer@sepago.de?subject=Request%20from%20ITProCloud.de"><i class="far fa-envelope"></i></a>
                </li>


                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">ITProCloud Blog</h1>
    <p class="lead">
        This is my personal website, which I maintain to support the cloud community. ITProCloud.de is the label I use for tests and demonstrations. ITProCloud.de is not a company in the business sense.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Deploy an Azure Functional App as an interface to Log Analytics / Azure Monitor&url=https://blog.itprocloud.de/Deploy-an-Azure-Functional-App-as-an-interface-to-Log-Analytics-Azure-Monitor/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=https://blog.itprocloud.de/Deploy-an-Azure-Functional-App-as-an-interface-to-Log-Analytics-Azure-Monitor/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://blog.itprocloud.de/Deploy-an-Azure-Functional-App-as-an-interface-to-Log-Analytics-Azure-Monitor/&title=Deploy an Azure Functional App as an interface to Log Analytics / Azure Monitor" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>
    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/avatar-mm.png" alt="Marcel">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://blog.itprocloud.de">Marcel</a><a target="_blank" href="https://twitter.com/MarcelMeurer" class="btn follow">Follow</a>
                        <span class="author-description">That's me: Marcel</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Deploy an Azure Functional App as an interface to Log Analytics / Azure Monitor</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/wp-content/uploads/2019/01/StreamAnalytics-Query-1024x395.png" alt="Deploy an Azure Functional App as an interface to Log Analytics / Azure Monitor">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <h1 id="introduction">Introduction</h1>

<p>Microsoft offers with Log Analytics a cloud-based big data service. Log Analytics is used by several services (including Azure itself) to log and analyze data. It’s a core component of Azure Monitor and Application Insights.</p>

<p>Log Analytics key facts:</p>

<ul>
  <li>Cloud-based</li>
  <li>No data aggregation</li>
  <li>Pay per upload and data retention</li>
  <li>Powerful query language (kql: &lt;<a href="https://docs.microsoft.com/en-us/azure/kusto/">https://docs.microsoft.com/en-us/azure/kusto/</a>&gt;)</li>
  <li>Direct support for visualization on portal.azure.com</li>
</ul>

<p>I use Log Analytics for several projects where data aggregation and analyzation are main tasks. If I write code, I push data directly to Log Analytics – including generating a SAS signature for every single upload.</p>

<p>The mandatory SAS signature avoids a simple upload via http-post to Log Analytics. But in some cases, it could be very helpful to work with a simple http-post command. For example: If you use Azure Stream Analytics, you cannot push data directly to Log Analytics.</p>

<p>To allow pushing data via http-post I built this project. This project deploys an Azure function to your subscription. This function offers a simple http(s) interface (webhook) you can use to post JSON data to it. This data will be processed by the Azure Function and will be posted to your Log Analytics workspace.</p>

<h1 id="examples">Examples:</h1>

<h2 id="with-postman">With Postman</h2>

<h1><img src="/wp-content/uploads/2019/01/Postman-1024x377.png" alt="img" /></h1>

<h2 id="with-powershell">With PowerShell</h2>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nv">$data</span><span class="o">=</span><span class="s1">'{
"localTime":"2019-01-02T11:11:12.013Z",
"Humi":46.5,
"Temp":14.2
}'</span><span class="w">

</span><span class="nf">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="s2">"https://testaf01xx8.azurewebsites.net/api/Send2LogAnalytics?code=xje5aQIMzPxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx=="</span><span class="w"> </span><span class="nt">-Method</span><span class="w"> </span><span class="nx">POST</span><span class="w"> </span><span class="nt">-Body</span><span class="w"> </span><span class="nv">$data</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/wp-content/uploads/2019/01/PowerShell-1024x656.png" alt="img" /></p>

<h2 id="with-stream-analytics">With Stream Analytics</h2>

<p><strong>Query:</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">INTO</span>
<span class="p">[</span><span class="k">To</span><span class="o">-</span><span class="k">Function</span><span class="p">]</span>
<span class="k">FROM</span>
<span class="p">[</span><span class="k">From</span><span class="o">-</span><span class="n">IoT</span><span class="o">-</span><span class="n">Hub</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/wp-content/uploads/2019/01/StreamAnalytics-Query-1024x395.png" alt="img" /></p>

<p><strong>Output:</strong></p>

<p>Enter your Azure Function parameters</p>

<p><img src="/wp-content/uploads/2019/01/StreamAnalytics-Output-1024x377.png" alt="img" /></p>

<h2 id="results-in-log-analytics">Results in Log Analytics</h2>

<p><img src="/wp-content/uploads/2019/01/LA1-1024x697.png" alt="img" /></p>

<p>For another data series</p>

<p><img src="/wp-content/uploads/2019/01/LA2-1024x665.png" alt="img" /></p>

<h1 id="deploying-and-configuration">Deploying and configuration</h1>

<p>Deploy your Azure Function using the deploy to Azure button.</p>

<p><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FMarcelMeurer%2FFunctionApp-to-LogAnalytics%2Fmaster%2Ftemplate.json"><img src="http://azuredeploy.net/deploybutton.png" alt="img" /></a></p>

<p>Github: <a href="https://github.com/MarcelMeurer/FunctionApp-to-LogAnalytics">https://github.com/MarcelMeurer/FunctionApp-to-LogAnalytics</a></p>

<h2 id="configuration">Configuration</h2>

<p>In the next step enter the following parameters:</p>

<ul>
  <li>Resource Group:
Select an existing or create a new resource group in a location of your choice (the function will be deployed in the Azure region of the resource group)</li>
  <li>Site name:
A unique name of your function (unique means a worldwide unique hostname; the fqdn is: <hostname>.azurewebsites.com)</hostname></li>
  <li>Workspace_Id:
The workspace id of your Log Analytics workspace (Log Analytics resource -&gt; Advanced settings -&gt; Workspace id)</li>
  <li>Workspace_Key:
The workspace id of your Log Analytics workspace (Log Analytics resource -&gt; Advanced settings -&gt; Primary or secondary key)</li>
  <li>LogType:
Name of your type (“table” name). You will see this name with an appended _CL (custom log) later in your workspace with your data</li>
  <li>Time Field:
Optional. All data sets you send get a new field called “TimeGenerated”. TimeGenerated contains the time the data arrived at the workspace. If you set Time field to a custom field (like localTime from the example above), the time in this field is used as TimeGenerated.</li>
</ul>

<p><strong>Hint:</strong> Workspace_Id, Workspace_Key, LogType, Time Field can be changed later in the function app:</p>

<p>Your Function app -&gt; Platform features -&gt; Application settings</p>

<p><img src="/wp-content/uploads/2019/01/AppSettings-1024x264.png" alt="img" /></p>

<h2 id="resources">Resources</h2>

<p>After the deployment three resources are deployed and configured:</p>

<ul>
  <li>ServerFarmPlan:
A consumption-based pricing plan for the Azure Functional App. See <a href="https://azure.microsoft.com/en-us/pricing/details/functions/">https://azure.microsoft.com/en-us/pricing/details/functions/</a> check the estimated costs billed to your subscription</li>
  <li>Site name - Application Insights:
Application Insights to monitor the Azure Function itself</li>
  <li>Site name - Azure Functional App:
The Azure Function containing the code</li>
</ul>

<h2 id="get-the-resource-url-of-the-azure-function">Get the resource URL of the Azure Function</h2>

<p>Open your Azure Function and navigate to Functions -&gt; Send2LogAnalytics -&gt; &lt;/&gt; Get function URL</p>

<p><img src="/wp-content/uploads/2019/01/FunctionURL-1024x377.png" alt="img" /></p>

<p>This URL contains your private key.</p>

<p>First published on: <a href="https://www.sepago.de/blog/deploy-an-azure-functional-app-as-an-interface-to-log-analytics-azure-monitor/">https://www.sepago.de/blog/deploy-an-azure-functional-app-as-an-interface-to-log-analytics-azure-monitor/</a></p>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2019-01-13">13 Jan 2019</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Azure-Functions">Azure Functions</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Azure-Monitor">Azure Monitor</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Log-Analytics">Log Analytics</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="/Creating-devices-for-Azure-IoT-Hub-with-SAS-token-automatically/"> &laquo; Creating devices for Azure IoT Hub with SAS token automatically</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="/Why-configuring-Azure-AD-authentication-with-an-Azure-Web-App-fails/">Why configuring Azure AD authentication with an Azure Web App fails &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div id="allTags" class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore by tags <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Azure-WebApp">Azure WebApp (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-VM">Azure VM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PowerShell">PowerShell (7)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Monitor">Azure Monitor (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Log-Analytics">Log Analytics (5)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-AD">Azure AD (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OneDrive">OneDrive (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-IoT">Azure IoT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Functions">Azure Functions (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure-Marketplace">Azure Marketplace (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Windows-Virtual-Desktop">Windows Virtual Desktop (12)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Events">Events (2)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-5 col-sm-5 text-center text-lg-left">
                Copyright © 2020 ITProCloud Blog 
            </div>
            <div class="col-md-4 col-sm-4 text-center text-lg-left">
                <a href="/Impressum">Impressum/Imprint</a> - 
                <a href="/privacyDe">Datenschutz</a> - 
				<a href="/privacyEn">Privacy</a>
            </div>
            <div class="col-md-3 col-sm-3 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//.disqus.com/count.js"></script>


<!-- Start Cookie Plugin -->
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#eaf7f7",
      "text": "#5c7291"
    },
    "button": {
      "background": "#56cbdb",
      "text": "#ffffff"
    }
  },
  "position": "bottom-right",
  "content": {
    "message": 'This website uses cookies to ensure you get the best experience on our website.<br/><a href="/privacyEn">Privacy policy</a><br/><br/>Diese Website verwendet Cookies, um dir mehr Benutzerfreundlichkeit zu bieten. Mit der Nutzung dieser Website stimmst du der Verwendung von Cookies zu.<br/><a href="/privacyDe">Datenschutzerklärung</a><br/><br/> ',
    "href": "/privacyEn"
  }
});
</script>
<!-- End Cookie Plugin -->

</body>
</html>
